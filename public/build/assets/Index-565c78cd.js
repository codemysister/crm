import{r as l,F as he,W as xe,j as a,R as fe}from"./app-183ca207.js";import{D as be,C as v}from"./column.esm-1f1d87c0.js";import{B as u}from"./button.esm-d3cd2157.js";import{D as ve}from"./DashboardLayout-217cf030.js";import{I as h}from"./inputtext.esm-0c7f541c.js";import{D as x}from"./dropdown.esm-0caba294.js";import{C as B,c as je}from"./confirmdialog.esm-3c4cbf5c.js";import{T as ye,a as C}from"./tabview.esm-5482a716.js";import{S as we}from"./SkeletonDatatable-07c9c4e2.js";import{H as Ne}from"./HeaderDatatable-497e5508.js";import{M as G}from"./Modal-50696ec9.js";import{T as _e}from"./toast.esm-b97f2233.js";import{I as o}from"./InputError-6be719bf.js";import{H as ke}from"./HeaderModule-b06ca799.js";import{O as Se}from"./overlaypanel.esm-9c3ae74e.js";import{g as Ce}from"./getViewportSize-e6da2c0c.js";import{r as Te,p as De}from"./filepond.min-8386e795.js";import{f}from"./formatDate-5c964a42.js";import{L as Le,A as Ie}from"./ArsipComponent-6d496fd7.js";import{I as n}from"./inputnumber.esm-6c4b14f0.js";import{B as Fe}from"./badge.esm-c550247d.js";import{h as Pe}from"./handleSelectedDetailInstitution-5c7c27d9.js";import"./ripple.esm-4b355069.js";import"./index.esm-9ef49f43.js";import"./index.esm-dca36cda.js";import"./index.esm-64ce51d8.js";import"./csstransition.esm-03d4c013.js";import"./inheritsLoose-2f6bfe9f.js";import"./index.esm-80aa95ee.js";import"./portal.esm-545bb246.js";import"./Dropdown-b69220a2.js";import"./dialog.esm-202fdef4.js";import"./index.esm-d51fec0e.js";import"./skeleton.esm-b303042b.js";import"./index.esm-c27cbd20.js";import"./assertThisInitialized-081f9914.js";import"./calendar.esm-fe4692a5.js";import"./message.esm-4bbe4c64.js";import"./sidebar.esm-1f854c9b.js";import"./PermissionErrorDialog-eff24ba6.js";Te(De);const ka=({auth:c,usersProp:$,partnersProp:W,statusesProp:q})=>{const[d,T]=l.useState(0),[Q,X]=l.useState(null),[D,Ve]=l.useState(W),[L,Ee]=l.useState($),[j,Re]=l.useState(q),[Y,I]=l.useState(!1),[F,Z]=l.useState(null),[ee,y]=l.useState(!1),w=l.useRef(null),P=l.useRef(null),N=Ce().width<992,[ae,V]=l.useState(!0),[te,_]=l.useState(!1),[se,k]=l.useState(!1);c.user;const[E,le]=l.useState({global:{value:null,matchMode:he.CONTAINS}}),{data:s,setData:r,post:re,put:ie,patch:Ae,delete:oe,reset:b,processing:R,errors:i,clearErrors:K}=xe({id:null,uuid:null,status:{id:j[0].id,name:j[0].name},partner:{id:null,name:null},pcs:0,price:0,total:0,approve_date:null,design_date:null,print_date:null,delivery_date:null,revision_detail:null});l.useState(""),l.useEffect(()=>{d==0&&A(p)},[d]);const p=async()=>{y(!0);let t=await(await fetch("/api/cards")).json();X(S=>t),y(!1)};l.useEffect(()=>{(async()=>{V(t=>!1)})()},[]);const A=async e=>{try{await Promise.all([e()]),y(!1),V(t=>t=!1)}catch(t){console.error("Error fetching data:",t)}};l.useEffect(()=>{A(p)},[]);const de=()=>a.jsx("i",{className:"pi pi-plus",style:{fontSize:"0.7rem",paddingRight:"5px"}}),ne=e=>a.jsx(fe.Fragment,{children:a.jsx("i",{className:"pi pi-ellipsis-h pointer cursor-pointer",onClick:t=>{Z(e),P.current.toggle(t)}})}),ce=e=>{r({...s,uuid:e.uuid,partner:e.partner,status:e.status,price:e.price,type:e.type,pcs:e.pcs,total:e.total,google_drive_link:e.google_drive_link,approve_date:e.approve_date,design_date:e.design_date,print_date:e.print_date,delivery_date:e.delivery_date}),K(),k(!0)},pe=()=>{oe("cards/"+F.uuid,{onSuccess:()=>{p(),m("Hapus"),b()},onError:()=>{g("Hapus")}})},me=()=>{je({message:"Apakah Anda yakin untuk menghapus ini?",header:"Konfirmasi hapus",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>{I(!0)}})},ge=()=>a.jsx(Ne,{filters:E,setFilters:le}),m=e=>{w.current.show({severity:"success",summary:"Success",detail:`${e} data berhasil`,life:3e3})},g=e=>{w.current.show({severity:"error",summary:"Error",detail:`${e} data gagal`,life:3e3})},M=(e,t)=>{e.preventDefault(),t==="tambah"?re("/cards",{onSuccess:()=>{m("Tambah"),_(S=>!1),p(),b(),T(S=>0)},onError:()=>{g("Tambah")}}):ie("/cards/"+s.uuid,{onSuccess:()=>{m("Update"),k(S=>!1),p(),b()},onError:()=>{g("Update")}})},H=(e,t)=>e?a.jsx("div",{className:"flex align-items-center",children:a.jsx("div",{children:e.name})}):a.jsx("span",{children:t.placeholder}),O=e=>a.jsx("div",{className:"flex align-items-center",children:a.jsx("div",{children:e.name})}),U=[{header:"Lembaga",frozen:!N,style:{width:"max-content",whiteSpace:"nowrap"},body:e=>a.jsx("button",{onClick:()=>Pe(e),className:"hover:text-blue-700 text-left",children:e.partner.name})},{field:"status",header:"Status",frozen:!N,style:N?null:{width:"max-content",whiteSpace:"nowrap"},body:e=>a.jsx(Fe,{value:e.status.name,className:"text-white",style:{backgroundColor:"#"+e.status.color}})},{field:"pcs",header:"Jumlah kartu",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>e.pcs},{field:"type",header:"Tipe",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>e.type},{field:"price",header:"Harga per kartu",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>"Rp"+e.price.toLocaleString("id")},{field:"total",header:"Total",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>"Rp"+e.total.toLocaleString("id")},{field:"google_drive_link",header:"Link Google Drive",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>a.jsx("a",{className:"text-blue-600 underline",href:e.google_drive_link,target:"_blank",children:"drive"})},{field:"approval_date",header:"Tanggal Approval",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>e.approval_date?f(e.approval_date):"-"},{field:"design_date",header:"Tanggal Design",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>e.design_date?f(e.design_date):"-"},{field:"print_date",header:"Tanggal Cetak",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>e.print_date?f(e.print_date):"-"},{field:"delivery_date",header:"Tanggal Pengiriman",style:{width:"max-content",whiteSpace:"nowrap"},body:e=>e.delivery_date?f(e.delivery_date):"-"}];let z=[{type:"digital"},{type:"cetak"}];const ue=e=>{let t;return e=="partner.name"?t="Lembaga":e=="status.name"?t="Status":e=="pcs"?t="Jumlah":e=="price"?t="Harga":e=="total"?t="Total":e=="google_drive_link"?t="Link google drive":e=="type"?t="Tipe kartu":e=="approval_date"?t="Tanggal Approval":e=="design_date"?t="Tanggal Design":e=="delivery_date"&&(t="Tanggal Pengiriman"),t},J=["title"];return ae?a.jsx(we,{auth:c}):a.jsxs(ve,{auth:c.user,className:"",children:[a.jsx(Se,{className:" shadow-md p-1 dark:bg-slate-900 dark:text-gray-300",ref:P,children:a.jsxs("div",{className:"flex flex-col flex-wrap w-full",children:[a.jsx(u,{icon:"pi pi-pencil",label:"edit",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{ce(F)}}),a.jsx(u,{icon:"pi pi-trash",label:"hapus",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{me()}})]})}),a.jsx(ke,{title:"Kartu",children:a.jsx(u,{label:"Tambah",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2",icon:de,onClick:()=>{_(e=>!0),b(),K()},"aria-controls":"popup_menu_right","aria-haspopup":!0})}),a.jsx(_e,{ref:w}),a.jsxs(ye,{activeIndex:d,onTabChange:e=>{T(e.index)},className:"mt-2",children:[a.jsx(C,{header:"Semua Kartu",children:d==0&&a.jsxs(a.Fragment,{children:[a.jsx(B,{}),a.jsx(B,{group:"declarative",visible:Y,onHide:()=>I(!1),message:"Konfirmasi kembali jika anda yakin!",header:"Konfirmasi kembali",icon:"pi pi-info-circle",accept:pe}),a.jsx("div",{className:"flex mx-auto flex-col justify-center mt-5 gap-5",children:a.jsx("div",{className:"card p-fluid w-full h-full flex justify-center rounded-lg",children:a.jsxs(be,{loading:ee,className:"w-full h-auto rounded-lg dark:glass border-none text-center shadow-md",pt:{bodyRow:"dark:bg-transparent bg-transparent dark:text-gray-300",table:"dark:bg-transparent bg-white dark:text-gray-300",header:""},paginator:!0,rowsPerPageOptions:[5,10,25,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} - {last} dari {totalRecords}",filters:E,rows:10,emptyMessage:"Kartu tidak ditemukan.",paginatorClassName:"dark:bg-transparent paginator-custome dark:text-gray-300 rounded-b-lg",header:ge,globalFilterFields:J,value:Q,dataKey:"id",children:[a.jsx(v,{header:"Aksi",body:ne,style:{width:"max-content",whiteSpace:"nowrap"},frozen:!0,align:"center",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"}),U.map(e=>a.jsx(v,{field:e.field,header:e.header,body:e.body,style:e.style,frozen:e.frozen,align:"left",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"})),a.jsx(v,{field:"created_at",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Tanggal Input",align:"left",body:e=>f(e.created_at),style:{width:"max-content",whiteSpace:"nowrap"}}),a.jsx(v,{field:"created_by",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Diinput Oleh",align:"left",body:e=>e.created_by.name,style:{width:"max-content",whiteSpace:"nowrap"}})]})})})]})}),a.jsx(C,{header:"Log",children:d==1&&a.jsx(Le,{auth:c,fetchUrl:"/api/cards/logs",filterUrl:"/cards/logs/filter",deleteUrl:"/cards/logs",objectKeyToIndo:ue,users:L,showSuccess:m,showError:g})}),a.jsx(C,{header:"Arsip",children:d==2&&a.jsx(Ie,{auth:c,users:L,fetchUrl:"/api/cards/arsip",forceDeleteUrl:"/cards/{id}/force",restoreUrl:"/cards/{id}/restore",filterUrl:"/cards/arsip/filter",columns:U,showSuccess:m,showError:g,globalFilterFields:J})})]}),a.jsx(G,{header:"Kartu",modalVisible:te,setModalVisible:_,children:a.jsxs("form",{onSubmit:e=>M(e,"tambah"),children:[a.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-4",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"lembaga",children:"Lembaga *"}),a.jsx(x,{value:s.partner,dataKey:"id",onChange:e=>{r(t=>({...t,partner:{...t.partner,id:e.target.value.id,name:e.target.value.name},pcs:e.target.value.total_members,type:e.target.value.price_list?JSON.parse(e.target.value.price_list.price_card).type:null,price:e.target.value.price_list?JSON.parse(e.target.value.price_list.price_card).price:0}))},options:D,optionLabel:"name",placeholder:"Pilih Lembaga",filter:!0,valueTemplate:H,itemTemplate:O,className:"w-full md:w-14rem"}),a.jsx(o,{message:i["partner.name"],className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"address",children:"Alamat pengiriman *"}),a.jsx(h,{value:s.address,onChange:e=>{r({...s,address:e.target.value})},className:"dark:bg-gray-300",id:"address","aria-describedby":"address-help"}),a.jsx(o,{message:i.address,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"price",children:"Harga *"}),a.jsx(n,{value:s.price,onChange:e=>{let t=e.value*s.pcs;r({...s,price:e.value,total:t})},className:"dark:bg-gray-300",id:"price","aria-describedby":"price-help",defaultValue:0,locale:"id-ID"}),a.jsx(o,{message:i.price,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"type",children:"Tipe *"}),a.jsx(x,{dataKey:"type",value:s.type,onChange:e=>r("type",e.value),options:z,optionLabel:"type",optionValue:"type",placeholder:"kategori",className:"w-full md:w-14rem"}),a.jsx(o,{message:i.type,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"pcs",children:"Jumlah (pcs) *"}),a.jsx(n,{value:s.pcs,onChange:e=>{let t=e.value*s.price;r({...s,pcs:e.value,total:t})},className:"dark:bg-gray-300",id:"pcs",locale:"id-ID","aria-describedby":"pcs-help"}),a.jsx(o,{message:i.pcs,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"total",children:"Total *"}),a.jsx(n,{value:s.total,onChange:e=>r("total",e.value),className:"dark:bg-gray-300",id:"total","aria-describedby":"total-help",defaultValue:0,disabled:!0,locale:"id-ID"}),a.jsx(o,{message:i.total,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"google_drive_link",children:"Link Google Drive *"}),a.jsx(h,{value:s.google_drive_link,onChange:e=>{r({...s,google_drive_link:e.target.value})},className:"dark:bg-gray-300",id:"google_drive_link","aria-describedby":"google_drive_link-help"}),a.jsx(o,{message:i.google_drive_link,className:"mt-2"})]})]}),a.jsx("div",{className:"flex justify-center mt-5",children:a.jsx(u,{label:"Submit",disabled:R,className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})}),a.jsx(G,{header:"Edit Kartu",modalVisible:se,setModalVisible:k,children:a.jsxs("form",{onSubmit:e=>M(e,"update"),children:[a.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-4",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"status",children:"Status *"}),a.jsx(x,{dataKey:"name",value:s.status,onChange:e=>{r("status",e.target.value)},options:j,optionLabel:"name",placeholder:"Pilih Status",className:"w-full md:w-14rem"}),a.jsx(o,{message:i["status.name"],className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"lembaga",children:"Lembaga *"}),a.jsx(x,{value:s.partner,dataKey:"id",onChange:e=>{r(t=>({...t,partner:{...t.partner,id:e.target.value.id,name:e.target.value.name},pcs:e.target.value.total_members,type:e.target.value.price_list?JSON.parse(e.target.value.price_list.price_card).type:null,price:e.target.value.price_list?JSON.parse(e.target.value.price_list.price_card).price:0}))},options:D,optionLabel:"name",placeholder:"Pilih Lembaga",filter:!0,valueTemplate:H,itemTemplate:O,className:"w-full md:w-14rem"}),a.jsx(o,{message:i["partner.name"],className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"address",children:"Alamat pengiriman *"}),a.jsx(h,{value:s.address,onChange:e=>{r({...s,address:e.target.value})},className:"dark:bg-gray-300",id:"address","aria-describedby":"address-help"}),a.jsx(o,{message:i.address,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"price",children:"Harga *"}),a.jsx(n,{value:s.price,onChange:e=>{let t=e.value*s.pcs;r({...s,price:e.value,total:t})},className:"dark:bg-gray-300",id:"price","aria-describedby":"price-help",defaultValue:0,locale:"id-ID"}),a.jsx(o,{message:i.price,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"type",children:"Tipe *"}),a.jsx(x,{dataKey:"type",value:s.type,onChange:e=>r("type",e.value),options:z,optionLabel:"type",optionValue:"type",placeholder:"kategori",className:"w-full md:w-14rem"}),a.jsx(o,{message:i.type,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"pcs",children:"Jumlah (pcs) *"}),a.jsx(n,{value:s.pcs,onChange:e=>{let t=e.value*s.price;r({...s,pcs:e.value,total:t})},className:"dark:bg-gray-300",id:"pcs",locale:"id-ID","aria-describedby":"pcs-help"}),a.jsx(o,{message:i.pcs,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"total",children:"Total *"}),a.jsx(n,{value:s.total,onChange:e=>r("total",e.value),className:"dark:bg-gray-300",id:"total","aria-describedby":"total-help",defaultValue:0,disabled:!0,locale:"id-ID"}),a.jsx(o,{message:i.total,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"google_drive_link",children:"Link Google Drive *"}),a.jsx(h,{value:s.google_drive_link,onChange:e=>{r({...s,google_drive_link:e.target.value})},className:"dark:bg-gray-300",id:"google_drive_link","aria-describedby":"google_drive_link-help"}),a.jsx(o,{message:i.google_drive_link,className:"mt-2"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{htmlFor:"revision_detail",children:"Detail Revisi *"}),a.jsx(h,{value:s.revision_detail,onChange:e=>{r({...s,revision_detail:e.target.value})},className:"dark:bg-gray-300",id:"revision_detail","aria-describedby":"revision_detail-help"}),a.jsx(o,{message:i.revision_detail,className:"mt-2"})]})]}),a.jsx("div",{className:"flex justify-center mt-5",children:a.jsx(u,{label:"Submit",disabled:R,className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})]})};export{ka as default};
