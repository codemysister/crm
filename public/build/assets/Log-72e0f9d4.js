import{r as n,W as X,F as L,j as e,b as y}from"./app-183ca207.js";import{H as Q}from"./HeaderDatatable-497e5508.js";import{S as Y}from"./SkeletonDatatable-07c9c4e2.js";import{B as Z}from"./badge.esm-c550247d.js";import{B as d}from"./button.esm-d3cd2157.js";import{C as k}from"./calendar.esm-fe4692a5.js";import{D as $,C as m}from"./column.esm-1f1d87c0.js";import{C as F,c as ee}from"./confirmdialog.esm-3c4cbf5c.js";import{D as te}from"./dropdown.esm-0caba294.js";import{M as h}from"./message.esm-4bbe4c64.js";import{O as ae}from"./overlaypanel.esm-9c3ae74e.js";import{S as se}from"./sidebar.esm-1f854c9b.js";import{f as re}from"./formatDate-5c964a42.js";import"./ripple.esm-4b355069.js";import"./inputtext.esm-0c7f541c.js";import"./DashboardLayout-217cf030.js";import"./Dropdown-b69220a2.js";import"./skeleton.esm-b303042b.js";import"./portal.esm-545bb246.js";import"./index.esm-d51fec0e.js";import"./index.esm-dca36cda.js";import"./csstransition.esm-03d4c013.js";import"./inheritsLoose-2f6bfe9f.js";import"./inputnumber.esm-6c4b14f0.js";import"./index.esm-9ef49f43.js";import"./index.esm-64ce51d8.js";import"./index.esm-80aa95ee.js";import"./dialog.esm-202fdef4.js";import"./index.esm-c27cbd20.js";const Ve=({auth:C,users:S,showError:le,showSuccess:T})=>{const[P,o]=n.useState(!1),[a,D]=n.useState(null),[c,R]=n.useState(null),[I,g]=n.useState(!1),[O,u]=n.useState(null),b=n.useRef(null),[K,E]=n.useState(!0),[M,j]=n.useState(null),v=n.useRef(),{data:i,setData:f,get:ne,post:ie,reset:A,processing:oe,errors:de,clearErrors:ce}=X({user:null,date:{start:null,end:null}}),[w,_]=n.useState({global:{value:null,matchMode:L.CONTAINS}}),[B,H]=n.useState(""),V=t=>{const s=t.target.value;let l={...w};l.global.value=s,_(l),H(s)},N=async()=>{o(!0);let s=await(await fetch("/api/leads/logs")).json();j(l=>s),o(!1)},z=()=>{ee({message:"Apakah Anda yakin untuk menghapus ini?",header:"Konfirmasi hapus",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>{g(!0)}})};n.useEffect(()=>{(async()=>{E(s=>!1),await N()})()},[]);const G=()=>e.jsxs(Q,{globalFilterValue:B,onGlobalFilterChange:V,children:[e.jsx(d,{className:"shadow-md border border-slate-600 bg-transparent text-slate-600 dark:bg-slate-700 dark:text-slate-300 rounded-md",onClick:()=>u(!0),children:e.jsxs("span",{className:"w-full flex justify-center items-center gap-1",children:[e.jsx("i",{className:"pi pi-filter",style:{fontSize:"0.7rem"}})," ",e.jsx("span",{children:"filter"})]})}),e.jsx(d,{severity:"danger",className:"rounded-md shadow-md text-sm",onClick:z,disabled:!c||!c.length,children:e.jsxs("span",{className:"w-full flex justify-center items-center gap-1",children:[e.jsx("i",{className:"pi pi-trash",style:{fontSize:"0.7rem"}})," ",e.jsx("span",{children:"hapus"})]})})]}),p=t=>{let s;const r=t.split(".")[0];return r=="name"?s="Nama":r=="total_members"?s="Jumlah member":r=="status"?s="Status":r=="pic"?s="PIC":r=="phone_number"?s="Nomor Telepon":s="Alamat",s},q=async t=>{t.preventDefault(),o(!0);const s={user:i.user,date:i.date},l=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),x=(await y.post("/leads/logs/filter",s,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":l}})).data;j(x),u(!1),o(!1)},J=async()=>{o(!0);const t=c.map(s=>s.id);await y.delete("/leads/logs?ids="+t,{headers:{"Content-Type":"application/json"}}).then(()=>{N(),T("Hapus"),setTimeout(()=>{o(!1)},1e3)})},U=(t,s)=>t?e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:t.name})}):e.jsx("span",{children:s.placeholder}),W=t=>e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:t.name})});return K?e.jsx(Y,{auth:C}):e.jsxs("div",{className:"flex mx-auto flex-col justify-center mt-5 gap-5",children:[e.jsx(F,{}),e.jsx(F,{group:"declarative",visible:I,onHide:()=>g(!1),message:"Konfirmasi kembali jika anda yakin!",header:"Konfirmasi kembali",icon:"pi pi-info-circle",accept:J}),e.jsx(se,{header:"Filter",visible:O,className:"w-full md:w-[30%] px-3 dark:glass dark:text-white",position:"right",onHide:()=>u(!1),children:e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"name",children:"Berdasarkan user"}),e.jsx(te,{optionLabel:"name",dataKey:"id",value:i.user,onChange:t=>f("user",t.target.value),options:S,placeholder:"Pilih User",filter:!0,showClear:!0,valueTemplate:U,itemTemplate:W,className:"flex justify-center  dark:text-gray-400   "})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"",children:"Tanggal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{value:i.date.start?new Date(i.date.start):null,style:{height:"35px"},onChange:t=>{f("date",{...i.date,start:t.target.value})},placeholder:"mulai",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("span",{children:"-"}),e.jsx(k,{value:i.date.end?new Date(i.date.end):null,style:{height:"35px"},onChange:t=>{f("date",{...i.date,end:t.target.value})},placeholder:"selesai",showIcon:!0,dateFormat:"dd/mm/yy"})]})]}),e.jsxs("div",{className:"flex flex-row mt-5",children:[e.jsx(d,{ref:b,label:"Terapkan",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2"}),e.jsx(d,{type:"button",label:"Kosongkan",onClick:t=>{A(),b.current.click()},className:"outline-purple-600 outline-1 outline-dotted bg-transparent text-slate-700 dark:text-slate-300  text-sm shadow-md rounded-lg mr-2"})]})]})}),e.jsx("div",{className:"card p-fluid w-full h-full flex justify-center rounded-lg",children:e.jsxs($,{id:"tablelog",loading:P,className:"table-log w-full h-auto rounded-lg dark:glass border-none text-center shadow-md",pt:{bodyRow:"dark:bg-transparent bg-transparent dark:text-gray-300",table:"dark:bg-transparent bg-white dark:text-gray-300",header:""},paginator:!0,rowsPerPageOptions:[5,10,25,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} - {last} dari {totalRecords}",rows:10,filters:w,emptyMessage:"Lead tidak ditemukan.",paginatorClassName:"dark:bg-transparent paginator-custome dark:text-gray-300 rounded-b-lg",header:G,globalFilterFields:["name","category","causer.name"],value:M,dataKey:"id",selection:c,onSelectionChange:t=>R(t.value),children:[e.jsx(m,{selectionMode:"multiple",exportable:!1,className:"w-[1%]"}),e.jsx(m,{field:"causer",hidden:!0,className:"dark:border-none",headerClassName:"dark:border-none bg-transparent dark:bg-transparent dark:text-gray-300",align:"left",style:{width:"max-content",whiteSpace:"nowrap"},body:t=>t.causer.name}),e.jsx(m,{field:"uuid",hidden:!0,className:"dark:border-none",headerClassName:"dark:border-none bg-transparent dark:bg-transparent dark:text-gray-300",align:"left",style:{width:"max-content",whiteSpace:"nowrap"}}),e.jsx(m,{className:"dark:border-none",headerClassName:"dark:border-none bg-transparent dark:bg-transparent dark:text-gray-300",header:"Aktivitas",align:"left",style:{width:"max-content",whiteSpace:"nowrap"},body:t=>{let s=t.causer?t.causer.name:"",l="",r="";return t.event=="created"?(l="tambah",r="success"):t.event=="restored"?(l="pulihkan",r="success"):t.event=="deleted"?(l="hapus",r="error"):t.event=="updated"?(l="edit",r="info"):t.event=="onboarding"&&(l="onboarding",r="info"),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Z,{value:l,severity:r=="error"?"danger":r,className:"w-20"}),e.jsx("p",{children:re(t.created_at)+", "+s+" "+t.description})]}),e.jsx("div",{children:e.jsx(d,{label:"detail",className:"p-0 underline bg-transparent text-blue-700 text-left",onClick:x=>{v.current.toggle(x),D(pe=>({properties:t.properties,event:t.event}))},"aria-controls":"popup_menu_right","aria-haspopup":!0})})]})}})]})}),e.jsx(ae,{className:"w-[40%] md:max-w-[50%] shadow-md dark:bg-slate-900 dark:text-gray-300",ref:v,showCloseIcon:!0,children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(a==null?void 0:a.event)=="created"||(a==null?void 0:a.event)=="onboarding"||(a==null?void 0:a.event)=="updated"||(a==null?void 0:a.event)=="restored"?e.jsx("div",{className:"flex-1 w-1/2",children:e.jsx(h,{className:"bg-green-300 text-green-800 rounded-md w-full",severity:"success",content:e.jsx("div",{className:"flex justify-between w-full max-h-[250px] overflow-y-scroll",children:e.jsxs("div",{className:"flex w-full flex-col gap-2",children:[((a==null?void 0:a.event)==="created"||(a==null?void 0:a.event)==="onboarding"||(a==null?void 0:a.event)==="restored")&&a!==null?Object.keys(a.properties.attributes).map(t=>t==="status.color"?null:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[p(t)," ",":"," ",a.properties.attributes[t]]}),e.jsx("hr",{className:"w-full bg-slate-300"})]})):null,(a==null?void 0:a.event)==="updated"&&a!==null?Object.keys(a.properties.attributes).map(t=>a.properties.attributes[t]!==a.properties.old[t]&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[p(t)," ",":"," ",a.properties.attributes[t]]}),e.jsx("hr",{className:"w-full bg-slate-300"})]})):null]})})})}):null,(a==null?void 0:a.event)=="updated"?e.jsx("div",{className:"flex-1 w-1/2",children:e.jsx(h,{className:"bg-red-300 text-red-800 rounded-md w-full",severity:"success",content:e.jsx("div",{className:"flex justify-between w-full max-h-[250px] overflow-y-scroll",children:e.jsx("div",{className:"flex w-full flex-col gap-2",children:a!==null?Object.keys(a.properties.old).map(t=>t==="status.color"?null:a.properties.attributes[t]!==a.properties.old[t]&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[p(t)," ",":"," ",a.properties.old[t]]}),e.jsx("hr",{className:" w-full bg-slate-300"})]})):null})})})}):null,(a==null?void 0:a.event)=="deleted"?e.jsx("div",{className:"flex-1 ",children:e.jsx(h,{className:"bg-red-300 text-red-800 rounded-md w-full",severity:"success",content:e.jsx("div",{className:"flex justify-between w-full max-h-[250px] overflow-y-scroll",children:e.jsx("div",{className:"flex w-full flex-col gap-2",children:Object.keys(a.properties.old).map(t=>t==="status.color"?null:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[p(t)," ",":"," ",a.properties.old[t]]}),e.jsx("hr",{className:" w-full bg-slate-300"})]}))})})})}):null]})})]})};export{Ve as default};
