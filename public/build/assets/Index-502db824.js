import{r as t,F as Ve,W as re,j as e,y as Ae}from"./app-183ca207.js";import{B as o}from"./button.esm-d3cd2157.js";import{D as Me}from"./DashboardLayout-217cf030.js";import{I as m}from"./inputtext.esm-0c7f541c.js";import{D as g}from"./dropdown.esm-0caba294.js";import{I as U}from"./inputtextarea.esm-555f4aba.js";import{C as ie,c as Re}from"./confirmdialog.esm-3c4cbf5c.js";import{T as Ue,a as k}from"./tabview.esm-5482a716.js";import{S as Ke}from"./SkeletonDatatable-07c9c4e2.js";import"./HeaderDatatable-497e5508.js";import{T as He}from"./toast.esm-b97f2233.js";import{I as d}from"./InputError-6be719bf.js";import{B as ze}from"./badge.esm-c550247d.js";import{H as Be}from"./HeaderModule-b06ca799.js";import{O as ne}from"./overlaypanel.esm-9c3ae74e.js";import{D as _}from"./dialog.esm-202fdef4.js";import{S as qe}from"./sidebar.esm-1f854c9b.js";import{F as Oe,r as Je,p as We}from"./filepond.min-8386e795.js";import{C as oe}from"./calendar.esm-fe4692a5.js";import $e from"./DetailLead-4b106853.js";import{g as Xe}from"./getViewportSize-e6da2c0c.js";import{L as Ge,A as Qe}from"./ArsipComponent-6d496fd7.js";import{DatatableLead as Ye}from"./DatatableLead-1f329781.js";import{P as Ze}from"./PermissionErrorDialog-eff24ba6.js";import"./ripple.esm-4b355069.js";import"./portal.esm-545bb246.js";import"./Dropdown-b69220a2.js";import"./index.esm-64ce51d8.js";import"./csstransition.esm-03d4c013.js";import"./inheritsLoose-2f6bfe9f.js";import"./index.esm-d51fec0e.js";import"./index.esm-dca36cda.js";import"./column.esm-1f1d87c0.js";import"./inputnumber.esm-6c4b14f0.js";import"./index.esm-9ef49f43.js";import"./index.esm-80aa95ee.js";import"./skeleton.esm-b303042b.js";import"./index.esm-c27cbd20.js";import"./assertThisInitialized-081f9914.js";import"./menu.esm-1df6c872.js";import"./card.esm-aad9a2fd.js";import"./progressspinner.esm-5c964cda.js";import"./DetailStatusLog-fd6ffc07.js";import"./formatDate-5c964a42.js";import"./DetailLog-70171b9e.js";import"./message.esm-4bbe4c64.js";import"./handleSelectedDetailInstitution-5c7c27d9.js";Je(We);function ls({auth:b,leadDetail:K,usersProp:de,statusProp:me,salesProp:ce}){const[u,N]=t.useState(0),[H,z]=t.useState(null),[ue,pe]=t.useState(null),[C,ea]=t.useState(de),[y,aa]=t.useState(me),[B,sa]=t.useState(ce),[he,q]=t.useState(!1),[j,xe]=t.useState(null),[O,p]=t.useState(!1),J=Xe().width<992,F=t.useRef(null),W=t.useRef(null),$=t.useRef(null),X=t.useRef(null),[fe,G]=t.useState(!0),[be,L]=t.useState(!1),[ge,I]=t.useState(!1),[je,D]=t.useState(!1),[ve,T]=t.useState(null),[we,E]=t.useState(!1),[Q,S]=t.useState(!1),{roles:la,permissions:P,data:Y}=b.user;t.useState({global:{value:null,matchMode:Ve.CONTAINS}});const{data:l,setData:r,post:Z,put:Ne,patch:ra,delete:ye,reset:v,processing:V,errors:n,clearErrors:ee}=re({id:null,uuid:null,name:null,address:null,pic:null,total_members:null,excel:null}),{data:i,setData:w,get:ia,post:na,reset:Se,processing:oa,errors:da,clearErrors:ma}=re({user:null,status:null,address:null,input_date:{start:null,end:null}});t.useState(""),t.useEffect(()=>{u==0&&ae(h)},[u]);const h=async()=>{p(!0);let s=await(await fetch("/api/leads")).json();z(s.leads),p(!1)};t.useEffect(()=>{K&&(se(K),N(3)),(async()=>{G(s=>!1),await h()})()},[]);const ae=async a=>{try{await Promise.all([a()]),p(!1),G(s=>s=!1)}catch(s){console.error("Error fetching data:",s)}};t.useEffect(()=>{ae(h)},[]);const ke=()=>e.jsx("i",{className:"pi pi-plus",style:{fontSize:"0.7rem",paddingRight:"5px"}}),_e=a=>{r({...l,uuid:a.uuid,name:a.name,pic:a.pic,sales:a.sales,phone_number:a.phone_number,address:a.address,total_members:a.total_members,status:a.status}),ee(),I(!0)},Ce=()=>{ye("leads/"+j.uuid,{onSuccess:()=>{h(),x("Hapus"),v()},onError:a=>{f(a)}})},Fe=()=>{Re({message:"Apakah Anda yakin untuk menghapus ini?",header:"Konfirmasi hapus",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>{q(!0)}})},A=(a,s)=>a?e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:a.name})}):e.jsx("span",{children:s.placeholder}),M=a=>e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:a.name})}),x=a=>{F.current.show({severity:"success",summary:"Success",detail:`${a} data berhasil`,life:3e3})},f=a=>{F.current.show({severity:"error",summary:"Error",detail:`${a} data gagal`,life:3e3})},se=async a=>{p(R=>!0);let c=await(await fetch("/leads/"+a.uuid)).json();pe(R=>c),p(R=>!1)},te=a=>{se(a),N(3)},Le=async a=>{a.preventDefault(),p(!0);const s={user:i.user,status:i.status,address:i.address,input_date:i.input_date},c=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Pe=(await axios.post("/leads/filter",s,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":c}})).data;z(Pe),T(!1),p(!1)},le=(a,s)=>{a.preventDefault(),s==="tambah"?Z("/leads",{onSuccess:()=>{x("Tambah"),L(c=>!1),h(),v(),N(c=>0)},onError:c=>{f("Tambah")}}):Ne("/leads/"+l.uuid,{onSuccess:()=>{x("Update"),I(c=>!1),h(),v()},onError:c=>{f("Update")}})},Ie=a=>{a.preventDefault(),Z("/leads/import",{onSuccess:()=>{x("Import"),E(s=>!1),h(),v()},onError:s=>{f("Import")}})},De=[["name","status.name","address","phone_number","pic"]],Te=[{field:"name",header:"Lembaga",frozen:!J,style:{width:"max-content",whiteSpace:"nowrap"},body:a=>e.jsx("button",{onClick:()=>te(a),className:"hover:text-blue-700 text-left",children:a.name})},{field:"status",header:"Status",frozen:!J,style:{width:"max-content",whiteSpace:"nowrap"},body:a=>e.jsx(ze,{value:a.status.name,className:"text-white",style:{backgroundColor:"#"+a.status.color}})},{field:"sales",header:"Sales",style:{width:"max-content",whiteSpace:"nowrap"},body:a=>a.sales?a.sales.name:"-"},{field:"phone_number",header:"Nomor Telepon",style:{width:"max-content",whiteSpace:"nowrap"}},{field:"address",header:"Alamat",style:{width:"max-content",whiteSpace:"nowrap"}},{field:"pic",header:"PIC",style:{width:"max-content",whiteSpace:"nowrap"}}],Ee=a=>{let s;return a=="name"?s="Lembaga":a=="status.name"?s="Status":a=="pic"?s="PIC":a=="sales.name"?s="Sales":a=="npwp"?s="NPWP":a=="total_members"?s="Jumlah Member":a=="address"&&(s="Alamat"),s};return fe?e.jsx(Ke,{auth:b}):e.jsxs(Me,{auth:b.user,className:"",children:[e.jsx(Ze,{dialogIsVisible:Q,setDialogVisible:S}),e.jsx(ne,{className:" shadow-md p-1 dark:bg-slate-800 dark:text-gray-300",ref:W,children:e.jsxs("div",{className:"flex flex-col flex-wrap w-full",children:[e.jsx(o,{icon:"pi pi-verified",label:"onboarding",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{Ae.get("/partners?onboarding="+j.uuid)}}),e.jsx(o,{icon:"pi pi-pencil",label:"edit",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{P.includes("edit lead")&&j.created_by.id==Y.id?_e(j):S(a=>!0)}}),e.jsx(o,{icon:"pi pi-trash",label:"hapus",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{P.includes("hapus lead")&&j.created_by.id==Y.id?Fe():S(a=>!0)}})]})}),e.jsx(He,{ref:F}),e.jsxs(Be,{title:"Lead",children:[P.includes("tambah lead")&&e.jsx(o,{label:"Tambah",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2",icon:ke,onClick:a=>$.current.toggle(a),"aria-controls":"popup_menu_right","aria-haspopup":!0}),e.jsx(ne,{ref:$,className:"shadow-md dark:bg-slate-800 dark:text-white",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{children:e.jsx(o,{label:"satuan",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 dark:hover:text-slate-900 dark:text-white border-b-2 border-slate-400",onClick:()=>{L(a=>!0),v(),ee()},"aria-controls":"popup_menu_right","aria-haspopup":!0})}),e.jsx("span",{children:e.jsx(o,{label:"import",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 dark:hover:text-slate-900 dark:text-white border-b-2 border-slate-400",onClick:()=>{E(a=>!0)},"aria-controls":"popup_menu_right","aria-haspopup":!0})})]})})]}),e.jsx(qe,{header:"Filter",visible:ve,className:"w-full md:w-[30%] px-3 dark:glass dark:text-white",position:"right",onHide:()=>T(!1),children:e.jsxs("form",{onSubmit:Le,children:[e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"name",children:"Berdasarkan penginput"}),e.jsx(g,{optionLabel:"name",dataKey:"id",value:i.user,onChange:a=>w("user",a.target.value),options:C,placeholder:"Pilih User",filter:!0,showClear:!0,valueTemplate:A,itemTemplate:M,className:"flex justify-center  dark:text-gray-400   "})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"address",children:"Alamat"}),e.jsx(m,{value:i.address,onChange:a=>w("address",a.target.value),className:"dark:bg-gray-300",id:"address","aria-describedby":"address-help"}),e.jsx(d,{message:n.address,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"status",children:"Status "}),e.jsx(g,{value:i.status,onChange:a=>{w("status",a.target.value)},options:y,optionLabel:"name",placeholder:"Pilih Status",className:"w-full md:w-14rem"}),e.jsx(d,{message:n.status,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"",children:"Tanggal Input"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{value:i.input_date.start?new Date(i.input_date.start):null,style:{height:"35px"},onChange:a=>{w("input_date",{...i.input_date,start:a.target.value})},placeholder:"mulai",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("span",{children:"-"}),e.jsx(oe,{value:i.input_date.end?new Date(i.input_date.end):null,style:{height:"35px"},onChange:a=>{w("input_date",{...i.input_date,end:a.target.value})},placeholder:"selesai",showIcon:!0,dateFormat:"dd/mm/yy"})]})]}),e.jsxs("div",{className:"flex flex-row mt-5",children:[e.jsx(o,{ref:X,label:"Terapkan",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2"}),e.jsx(o,{type:"button",label:"Reset",onClick:a=>{Se(),X.current.click()},className:"outline-purple-600 outline-1 outline-dotted bg-transparent text-slate-700 dark:text-slate-300  text-sm shadow-md rounded-lg mr-2"})]})]})}),e.jsxs(Ue,{activeIndex:u,onTabChange:a=>{N(a.index)},className:"mt-2",children:[e.jsx(k,{header:"Semua Lead",children:u==0&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),e.jsx(ie,{group:"declarative",visible:he,onHide:()=>q(!1),message:"Konfirmasi kembali jika anda yakin!",header:"Konfirmasi kembali",icon:"pi pi-info-circle",accept:Ce}),e.jsx("div",{className:"flex mx-auto flex-col justify-center mt-5 gap-5",children:e.jsx("div",{className:"card p-fluid w-full h-full flex justify-center rounded-lg",children:e.jsx(Ye,{leads:H,isLoadingData:O,setSelectedLead:xe,action:W,setSidebarFilter:T})})})]})}),e.jsx(k,{header:"Log",children:u==1&&e.jsx(Ge,{auth:b,fetchUrl:"/api/leads/logs",filterUrl:"/leads/logs/filter",deleteUrl:"/leads/logs",objectKeyToIndo:Ee,users:C,showSuccess:x,showError:f})}),e.jsx(k,{header:"Arsip",children:u==2&&e.jsx(Qe,{auth:b,users:C,fetchUrl:"/api/leads/arsip",forceDeleteUrl:"/leads/{id}/force",restoreUrl:"/leads/{id}/restore",filterUrl:"/leads/arsip/filter",columns:Te,showSuccess:x,showError:f,globalFilterFields:De})}),e.jsx(k,{header:"Detail lead",children:u==3&&e.jsx($e,{auth:b,leads:H,DetailLead:ue,showSuccess:x,showError:f,status:y,isLoading:O,handleSelectedDetailLead:te,permissionErrorIsVisible:Q,setPermissionErrorIsVisible:S})})]}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(_,{header:"Lead",headerClassName:"dark:bg-slate-900 dark:text-white",className:"bg-white min-h-[500px] max-h-[80%] w-[80%] md:w-[60%] lg:w-[30%] dark:glass dark:text-white",contentClassName:"dark:bg-slate-900 dark:text-white",visible:be,onHide:()=>L(!1),children:e.jsxs("form",{onSubmit:a=>le(a,"tambah"),children:[e.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",children:"Lembaga *"}),e.jsx(m,{value:l.name,onChange:a=>r("name",a.target.value),className:"dark:bg-gray-300",id:"name",required:!0,"aria-describedby":"name-help"}),e.jsx(d,{message:n.name,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"pic",children:"PIC *"}),e.jsx(m,{value:l.pic,onChange:a=>r("pic",a.target.value),className:"dark:bg-gray-300",id:"pic",required:!0,"aria-describedby":"pic-help"}),e.jsx(d,{message:n.pic,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"sales",children:"Pilih Sales *"}),e.jsx(g,{value:l.sales,onChange:a=>r("sales",a.target.value),options:B,dataKey:"id",optionLabel:"name",placeholder:"Pilih Sales",filter:!0,showClear:!0,valueTemplate:A,itemTemplate:M,className:"w-full md:w-14rem"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"phone_number",children:"Nomor Telepon *"}),e.jsx(m,{keyfilter:"int",value:l.phone_number,onChange:a=>r("phone_number",a.target.value),className:"dark:bg-gray-300",id:"phone_number","aria-describedby":"phone_number-help"}),e.jsx(d,{message:n.phone_number,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"address",children:"Alamat *"}),e.jsx(U,{value:l.address,onChange:a=>r("address",a.target.value),rows:5,cols:30})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"total_members",children:"Jumlah Member *"}),e.jsx(m,{keyfilter:"int",value:l.total_members,onChange:a=>r("total_members",a.target.value),className:"dark:bg-gray-300",id:"total_members","aria-describedby":"total_members-help"}),e.jsx(d,{message:n.total_members,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"status",children:"Status *"}),e.jsx(g,{value:l.status,onChange:a=>{r("status",a.target.value)},dataKey:"name",options:y,optionLabel:"name",placeholder:"Pilih Status",className:"w-full md:w-14rem"}),e.jsx(d,{message:n.status,className:"mt-2"})]})]}),e.jsx("div",{className:"flex justify-center mt-5",children:e.jsx(o,{label:"Submit",disabled:V,className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(_,{header:"Lead",headerClassName:"dark:bg-slate-900 dark:text-white",className:"bg-white min-h-[500px] max-h-[80%] w-[80%] md:w-[60%] lg:w-[30%] dark:glass dark:text-white",contentClassName:"dark:bg-slate-900 dark:text-white",visible:ge,onHide:()=>I(!1),children:e.jsxs("form",{onSubmit:a=>le(a,"update"),children:[e.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",children:"Nama *"}),e.jsx(m,{value:l.name,onChange:a=>r("name",a.target.value),className:"dark:bg-gray-300",id:"name",required:!0,"aria-describedby":"name-help"}),e.jsx(d,{message:n.name,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"pic",children:"PIC *"}),e.jsx(m,{value:l.pic,onChange:a=>r("pic",a.target.value),className:"dark:bg-gray-300",id:"pic",required:!0,"aria-describedby":"pic-help"}),e.jsx(d,{message:n.pic,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"sales",children:"Pilih Sales *"}),e.jsx(g,{value:l.sales,onChange:a=>r("sales",a.target.value),options:B,optionLabel:"name",placeholder:"Pilih Sales",filter:!0,valueTemplate:A,itemTemplate:M,className:"w-full md:w-14rem"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"phone_number",children:"Nomor Telepon *"}),e.jsx(m,{keyfilter:"int",value:l.phone_number,onChange:a=>r("phone_number",a.target.value),className:"dark:bg-gray-300",id:"phone_number","aria-describedby":"phone_number-help"}),e.jsx(d,{message:n.phone_number,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"address",children:"Alamat *"}),e.jsx(U,{value:l.address,onChange:a=>r("address",a.target.value),rows:5,cols:30})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"total_members",children:"Jumlah Member *"}),e.jsx(m,{keyfilter:"int",value:l.total_members,onChange:a=>r("total_members",a.target.value),className:"dark:bg-gray-300",id:"total_members","aria-describedby":"total_members-help"}),e.jsx(d,{message:n.total_members,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"status",children:"Status *"}),e.jsx(g,{value:l.status,onChange:a=>{r("status",a.target.value),D(!0)},dataKey:"name",options:y,optionLabel:"name",placeholder:"Pilih Status",className:"w-full md:w-14rem"}),e.jsx(d,{message:n.status,className:"mt-2"})]})]}),e.jsx("div",{className:"flex justify-center mt-5",children:e.jsx(o,{label:"Submit",disabled:V,className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(_,{header:"Import Lead",headerClassName:"dark:glass dark:text-white",className:"bg-white max-h-[80%] w-[80%] md:w-[60%] lg:w-[35%] dark:glass dark:text-white",contentClassName:" dark:glass dark:text-white",visible:we,onHide:()=>E(!1),children:e.jsxs("form",{onSubmit:a=>Ie(a),className:"my-4",children:[e.jsx("div",{className:"flex flex-col mt-3",children:e.jsxs("div",{className:"flex bg-green-600 text-white text-xs p-3 rounded-lg justify-between w-full h-full",children:[e.jsx("p",{children:"Template"}),e.jsx("p",{className:"font-semibold",children:e.jsx("a",{href:"/assets/template/excel/lead_sample.xlsx",download:"sample.xlsx",class:"font-bold underline w-full h-full text-center rounded-full ",children:"sample.xlsx"})})]})}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"name",children:"Excel"}),e.jsx("div",{className:"App",children:e.jsx(Oe,{onaddfile:(a,s)=>{r("excel",s.file)},maxFileSize:"2mb",labelMaxFileSizeExceeded:"File terlalu besar",name:"files",labelIdle:'Drag & Drop your files or <span class="filepond--label-action">Browse</span>'})})]}),e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx(o,{label:"Submit",disabled:V,className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})}),e.jsx(_,{header:"Edit status",headerClassName:"dark:bg-slate-900 dark:text-white",className:"bg-white h-[250px] max-h-[80%] w-[80%] md:w-[60%] lg:w-[35%] dark:glass dark:text-white",contentClassName:"dark:bg-slate-900 dark:text-white",visible:je,modal:!1,closable:!1,onHide:()=>D(!1),children:e.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"note_status",children:"Keterangan"}),e.jsx(U,{value:l.note_status,onChange:a=>r("note_status",a.target.value),rows:5,cols:30})]}),e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx(o,{type:"button",label:"oke",disabled:l.note_status==null||l.note_status=="",onClick:()=>D(!1),className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})]})}export{ls as default};
