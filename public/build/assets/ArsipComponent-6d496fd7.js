import{r,W as Q,F as ie,j as e,b as ne,R as ge}from"./app-183ca207.js";import{H as de}from"./HeaderDatatable-497e5508.js";import{S as oe}from"./SkeletonDatatable-07c9c4e2.js";import{f as ce}from"./formatDate-5c964a42.js";import{B as be}from"./badge.esm-c550247d.js";import{B as p}from"./button.esm-d3cd2157.js";import{C as I}from"./calendar.esm-fe4692a5.js";import{D as pe,C as x}from"./column.esm-1f1d87c0.js";import{C as E,c as Y}from"./confirmdialog.esm-3c4cbf5c.js";import{D as ue}from"./dropdown.esm-0caba294.js";import{M as G}from"./message.esm-4bbe4c64.js";import{O as me}from"./overlaypanel.esm-9c3ae74e.js";import{S as xe}from"./sidebar.esm-1f854c9b.js";import{g as je}from"./getViewportSize-e6da2c0c.js";import{P as ve}from"./PermissionErrorDialog-eff24ba6.js";const we=({auth:b,users:H,showError:Z,showSuccess:k,fetchUrl:S,filterUrl:K,deleteUrl:M,objectKeyToIndo:h})=>{const[V,u]=r.useState(!1),[t,z]=r.useState(null),[f,C]=r.useState(null),[ee,F]=r.useState(!1),[D,c]=r.useState(null),P=r.useRef(null),[B,g]=r.useState(!0),[L,j]=r.useState(null),R=r.useRef(),{roles:ae,permissions:T,data:_}=b.user,{data:n,setData:v,get:te,post:O,reset:se,processing:fe,errors:J,clearErrors:re}=Q({user:null,date:{start:null,end:null}}),[A,U]=r.useState({global:{value:null,matchMode:ie.CONTAINS}});r.useState("");const i=async()=>{u(!0);let d=await(await fetch(S)).json();j(l=>d),u(!1)},w=()=>{Y({message:"Apakah Anda yakin untuk menghapus ini?",header:"Konfirmasi hapus",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>{F(!0)}})};r.useEffect(()=>{(async()=>{g(d=>!1),await i()})()},[]);const $=()=>e.jsxs(de,{filters:A,setFilters:U,children:[e.jsx(p,{className:"shadow-md border border-slate-600 bg-transparent text-slate-600 dark:bg-slate-700 dark:text-slate-300 rounded-md",onClick:()=>c(!0),children:e.jsxs("span",{className:"w-full flex justify-center items-center gap-1",children:[e.jsx("i",{className:"pi pi-filter",style:{fontSize:"0.7rem"}})," ",e.jsx("span",{children:"filter"})]})}),T.includes("hapus log")&&e.jsx(p,{severity:"danger",className:"rounded-md shadow-md text-sm",onClick:w,disabled:!f||!f.length,children:e.jsxs("span",{className:"w-full flex justify-center items-center gap-1",children:[e.jsx("i",{className:"pi pi-trash",style:{fontSize:"0.7rem"}})," ",e.jsx("span",{children:"hapus"})]})})]}),N=async a=>{a.preventDefault(),u(!0);const d={user:n.user,date:n.date},l=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),y=(await ne.post(K,d,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":l}})).data;j(y),c(!1),u(!1)},q=async()=>{u(!0);const a=f.map(d=>d.id);await ne.delete(`${M}?ids=`+a,{headers:{"Content-Type":"application/json"}}).then(()=>{i(),k("Hapus"),setTimeout(()=>{u(!1)},1e3)})},X=(a,d)=>a?e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:a.name})}):e.jsx("span",{children:d.placeholder}),W=a=>e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:a.name})});return B?e.jsx(oe,{auth:b}):e.jsxs("div",{className:"flex mx-auto flex-col justify-center mt-5 gap-5",children:[e.jsx(E,{}),e.jsx(E,{group:"declarative",visible:ee,onHide:()=>F(!1),message:"Konfirmasi kembali jika anda yakin!",header:"Konfirmasi kembali",icon:"pi pi-info-circle",accept:q}),e.jsx(xe,{header:"Filter",visible:D,className:"w-full md:w-[30%] px-3 dark:glass dark:text-white",position:"right",onHide:()=>c(!1),children:e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"name",children:"Berdasarkan user"}),e.jsx(ue,{optionLabel:"name",dataKey:"id",value:n.user,onChange:a=>v("user",a.target.value),options:H,placeholder:"Pilih User",filter:!0,showClear:!0,valueTemplate:X,itemTemplate:W,className:"flex justify-center  dark:text-gray-400   "})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"",children:"Tanggal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{value:n.date.start?new Date(n.date.start):null,style:{height:"35px"},onChange:a=>{v("date",{...n.date,start:a.target.value})},placeholder:"mulai",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("span",{children:"-"}),e.jsx(I,{value:n.date.end?new Date(n.date.end):null,style:{height:"35px"},onChange:a=>{v("date",{...n.date,end:a.target.value})},placeholder:"selesai",showIcon:!0,dateFormat:"dd/mm/yy"})]})]}),e.jsxs("div",{className:"flex flex-row mt-5",children:[e.jsx(p,{ref:P,label:"Terapkan",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2"}),e.jsx(p,{type:"button",label:"Reset",onClick:a=>{se(),setTimeout(()=>{P.current.click()},500)},className:"outline-purple-600 outline-1 outline-dotted bg-transparent text-slate-700 dark:text-slate-300  text-sm shadow-md rounded-lg mr-2"})]})]})}),e.jsx("div",{className:"card p-fluid w-full h-full flex justify-center rounded-lg",children:e.jsxs(pe,{id:"tablelog",loading:V,className:"table-log w-full h-auto rounded-lg dark:glass border-none text-center shadow-md",pt:{bodyRow:"dark:bg-transparent bg-transparent dark:text-gray-300",table:"dark:bg-transparent bg-white dark:text-gray-300",header:""},paginator:!0,rowsPerPageOptions:[5,10,25,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} - {last} dari {totalRecords}",rows:10,filters:A,emptyMessage:"Log tidak ditemukan.",paginatorClassName:"dark:bg-transparent paginator-custome dark:text-gray-300 rounded-b-lg",header:$,globalFilterFields:["name","category","causer.name"],value:L,dataKey:"id",selection:f,onSelectionChange:a=>C(a.value),children:[T.includes("hapus log")&&e.jsx(x,{selectionMode:"multiple",exportable:!1,className:"w-[1%]"}),e.jsx(x,{field:"causer",hidden:!0,className:"dark:border-none",headerClassName:"dark:border-none bg-transparent dark:bg-transparent dark:text-gray-300",align:"left",style:{width:"max-content",whiteSpace:"nowrap"},body:a=>a.causer.name}),e.jsx(x,{field:"uuid",hidden:!0,className:"dark:border-none",headerClassName:"dark:border-none bg-transparent dark:bg-transparent dark:text-gray-300",align:"left",style:{width:"max-content",whiteSpace:"nowrap"}}),e.jsx(x,{className:"dark:border-none",headerClassName:"dark:border-none bg-transparent dark:bg-transparent dark:text-gray-300",header:"Aktivitas",align:"left",style:{width:"max-content",whiteSpace:"nowrap"},body:a=>{let d=a.causer?a.causer.name:"",l="",o="";return a.event=="created"?(l="tambah",o="success"):a.event=="restored"?(l="pulihkan",o="success"):a.event=="payment"?(l="Pembayaran",o="success"):a.event=="deleted"?(l="hapus",o="error"):a.event=="updated"?(l="edit",o="info"):a.event=="onboarding"?(l="onboarding",o="info"):a.event=="force"&&(l="hapus permanent",o="error"),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(be,{value:l,severity:o=="error"?"danger":o,className:"w-28"}),e.jsx("p",{children:ce(a.created_at)+", "+d+" "+a.description})]}),e.jsx("div",{children:e.jsx(p,{label:"detail",className:"p-0 underline bg-transparent text-blue-700 text-left",onClick:y=>{R.current.toggle(y),z(s=>({properties:a.properties,event:a.event}))},"aria-controls":"popup_menu_right","aria-haspopup":!0})})]})}})]})}),e.jsx(me,{className:"w-[80%] md:max-w-[60%] shadow-md dark:bg-slate-900 dark:text-gray-300",ref:R,showCloseIcon:!0,children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(t==null?void 0:t.event)=="created"||(t==null?void 0:t.event)=="onboarding"||(t==null?void 0:t.event)=="updated"||(t==null?void 0:t.event)=="payment"||(t==null?void 0:t.event)=="restored"?e.jsx("div",{className:"flex-1 w-1/2",children:e.jsx(G,{className:"bg-green-300 text-green-800 rounded-md w-full",severity:"success",content:e.jsx("div",{className:"flex justify-between w-full max-h-[250px] overflow-y-scroll",children:e.jsxs("div",{className:"flex w-full flex-col gap-2",children:[((t==null?void 0:t.event)==="created"||(t==null?void 0:t.event)==="onboarding"||(t==null?void 0:t.event)==="payment"||(t==null?void 0:t.event)==="restored")&&t!==null?Object.keys(t.properties.attributes).map(a=>a==="status.color"||t.properties.attributes[a]===null?null:e.jsxs(e.Fragment,{children:[t.properties.attributes[a]!==null&&e.jsxs("p",{children:[h(a)," ",":"," ",a==="province"||a==="regency"?JSON.parse(t.properties.attributes[a]).name:t.properties.attributes[a]]}),e.jsx("hr",{className:"w-full bg-slate-300"})]})):null,(t==null?void 0:t.event)==="updated"&&t!==null?Object.keys(t.properties.attributes).map(a=>t.properties.attributes[a]===null?null:t.properties.attributes[a]!==t.properties.old[a]&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[h(a)," ",":"," ",a==="province"||a==="regency"?JSON.parse(t.properties.attributes[a]).name:t.properties.attributes[a]]}),e.jsx("hr",{className:"w-full bg-slate-300"})]})):null]})})})}):null,(t==null?void 0:t.event)=="updated"?e.jsx("div",{className:"flex-1 w-1/2",children:e.jsx(G,{className:"bg-red-300 text-red-800 rounded-md w-full",severity:"success",content:e.jsx("div",{className:"flex justify-between w-full max-h-[250px] overflow-y-scroll",children:e.jsx("div",{className:"flex w-full flex-col gap-2",children:t!==null?Object.keys(t.properties.old).map(a=>a==="status.color"||t.properties.attributes[a]===null?null:t.properties.attributes[a]!==t.properties.old[a]&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[h(a)," ",":"," ",a==="province"||a==="regency"?JSON.parse(t.properties.old[a]).name:t.properties.old[a]]}),e.jsx("hr",{className:" w-full bg-slate-300"})]})):null})})})}):null,(t==null?void 0:t.event)=="deleted"||(t==null?void 0:t.event)=="force"?e.jsx("div",{className:"flex-1 ",children:e.jsx(G,{className:"bg-red-300 text-red-800 rounded-md w-full",severity:"success",content:e.jsx("div",{className:"flex justify-between w-full max-h-[250px] overflow-y-scroll",children:e.jsx("div",{className:"flex w-full flex-col gap-2",children:Object.keys(t.properties.old).map(a=>a==="status.color"||t.properties.old[a]===null?null:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[h(a)," ",":"," ",a==="province"||a==="regency"?JSON.parse(t.properties.old[a]).name:t.properties.old[a]]}),e.jsx("hr",{className:" w-full bg-slate-300"})]}))})})})}):null]})})]})},Me=we,Ne=({auth:b,noFilter:H,users:Z,showSuccess:k,showError:S,fetchUrl:K,restoreUrl:M,forceDeleteUrl:h,filterUrl:V,globalFilterFields:u,columns:t})=>{const[z,f]=r.useState(null),C=r.useRef(null),F=je().width<992,D=r.useRef(null),[c,P]=r.useState(null),[B,g]=r.useState(!1),[L,j]=r.useState(),[R,ae]=r.useState(!0),[T,_]=r.useState(!1),[n,v]=r.useState({global:{value:null,matchMode:ie.CONTAINS}}),[te,O]=r.useState(!1),{roles:se,permissions:fe,data:J}=b.user,{put:re,delete:A,reset:U}=Q({id:null,uuid:null,name:null,address:null,pic:null,total_members:null}),{data:i,setData:w,reset:$}=Q({user:null,delete_date:{start:null,end:null}});r.useState("");const N=async()=>{g(!0);let m=await(await fetch(K)).json();f(le=>m),g(!1)};r.useEffect(()=>{(async()=>{ae(m=>!1),await N()})()},[]);const q=()=>e.jsx(de,{filters:n,setFilters:v,children:H!=!0&&e.jsx(p,{className:"shadow-md w-[10px] lg:w-[90px] border border-slate-600 bg-transparent text-slate-600 dark:bg-slate-700 dark:text-slate-300 rounded-lg",onClick:()=>_(!0),children:e.jsxs("span",{className:"w-full flex justify-center items-center gap-1",children:[e.jsx("i",{className:"pi pi-filter",style:{fontSize:"0.7rem"}})," ",!F&&e.jsx("span",{children:"filter"})]})})}),X=s=>e.jsx(ge.Fragment,{children:e.jsx("i",{className:"pi pi-ellipsis-h pointer cursor-pointer",onClick:m=>{P(s),C.current.toggle(m)}})}),W=()=>{let s=M.replace("{id}",c.uuid??c.id);Y({message:"Apakah Anda yakin mengembalikan data ini?",header:"Konfirmasi pemulihan",icon:"pi pi-info-circle",acceptClassName:"p-button-success",accept:async()=>{re(s,{onSuccess:()=>{N(),k("Hapus")},onError:()=>{S("Hapus")}})}})},a=()=>{Y({message:"Apakah Anda yakin untuk menghapus ini?",header:"Konfirmasi hapus",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>{j(!0)}})},d=(s,m)=>s?e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:s.name})}):e.jsx("span",{children:m.placeholder}),l=s=>e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:s.name})}),o=()=>{let s=h.replace("{id}",c.uuid??c.id);A(s,{onSuccess:()=>{N(),k("Hapus"),U()},onError:()=>{S("Hapus")}})},y=async s=>{s.preventDefault(),g(!0);const m={user:i.user,delete_date:i.delete_date},le=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),he=(await axios.post(V,m,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":le}})).data;f(he),_(!1),g(!1)};return R?e.jsx(oe,{auth:b}):e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsx(E,{group:"declarative",visible:L,onHide:()=>j(!1),message:"Konfirmasi kembali jika anda yakin!",header:"Konfirmasi kembali",icon:"pi pi-info-circle",accept:o}),e.jsx(ve,{dialogIsVisible:te,setDialogVisible:O}),e.jsx(xe,{header:"Filter",visible:T,className:"w-full md:w-[30%] px-3 dark:glass dark:text-white",position:"right",onHide:()=>_(!1),children:e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"name",children:"Berdasarkan user"}),e.jsx(ue,{optionLabel:"name",dataKey:"id",value:i.user,onChange:s=>w("user",s.target.value),options:Z,placeholder:"Pilih User",filter:!0,showClear:!0,valueTemplate:d,itemTemplate:l,className:"flex justify-center  dark:text-gray-400   "})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"",children:"Tanggal Hapus"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{value:i.delete_date.start?new Date(i.delete_date.start):null,style:{height:"35px"},onChange:s=>{w("delete_date",{...i.delete_date,start:s.target.value})},placeholder:"mulai",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("span",{children:"-"}),e.jsx(I,{value:i.delete_date.end?new Date(i.delete_date.end):null,style:{height:"35px"},onChange:s=>{w("delete_date",{...i.delete_date,end:s.target.value})},placeholder:"selesai",showIcon:!0,dateFormat:"dd/mm/yy"})]})]}),e.jsxs("div",{className:"flex flex-row mt-5",children:[e.jsx(p,{ref:D,label:"Terapkan",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2"}),e.jsx(p,{type:"button",label:"Reset",onClick:s=>{$(),setTimeout(()=>{D.current.click()},500)},className:"outline-purple-600 outline-1 outline-dotted bg-transparent text-slate-700  text-sm shadow-md rounded-lg mr-2"})]})]})}),e.jsx(me,{className:"shadow-md p-1 dark:bg-slate-900 dark:text-gray-300",ref:C,children:e.jsxs("div",{className:"flex flex-col flex-wrap w-full",children:[e.jsx(p,{icon:"pi pi-replay",label:"pulihkan",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{c.created_by.id==J.id?W():O(s=>!0)}}),e.jsx(p,{icon:"pi pi-trash",label:"hapus permanen",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{c.created_by.id==J.id?a():O(s=>!0)}})]})}),e.jsx("div",{className:"flex mx-auto flex-col justify-center mt-5 gap-5",children:e.jsx("div",{className:"card p-fluid w-full h-full flex justify-center rounded-lg",children:e.jsxs(pe,{loading:B,className:"w-full h-auto rounded-lg dark:glass border-none text-center shadow-md",pt:{bodyRow:"dark:bg-transparent bg-transparent dark:text-gray-300",table:"dark:bg-transparent bg-white dark:text-gray-300",header:""},paginator:!0,rowsPerPageOptions:[5,10,25,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} - {last} dari {totalRecords}",rows:10,filters:n,emptyMessage:"Data tidak ditemukan.",paginatorClassName:"dark:bg-transparent paginator-custome dark:text-gray-300 rounded-b-lg",header:q,globalFilterFields:u,value:z,dataKey:"id",children:[e.jsx(x,{header:"Aksi",body:X,align:"center",style:{width:"max-content",whiteSpace:"nowrap"},className:"dark:border-none",headerClassName:"dark:border-none  bg-transparent dark:bg-transparent dark:text-gray-300"}),t.map(s=>e.jsx(x,{field:s.field,header:s.header,body:s.body,style:s.style,frozen:s.frozen,align:"left",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"})),e.jsx(x,{field:"created_at",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Tanggal Input",align:"left",body:s=>ce(s.created_at),style:{width:"max-content",whiteSpace:"nowrap"}}),e.jsx(x,{field:"created_by",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Diinput Oleh",align:"left",body:s=>s.created_by?s.created_by.name:"-",style:{width:"max-content",whiteSpace:"nowrap"}})]})})})]})},Ve=Ne;export{Ve as A,Me as L};
