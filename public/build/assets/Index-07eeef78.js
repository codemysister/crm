import{r as t,W as C,F as J,j as e,b as K}from"./app-183ca207.js";import{D as R}from"./DashboardLayout-217cf030.js";import{D as Q,C as i}from"./column.esm-1f1d87c0.js";import{I as g}from"./inputtext.esm-0c7f541c.js";import{D}from"./dialog.esm-202fdef4.js";import{T as X}from"./toast.esm-b97f2233.js";import{B as _}from"./button.esm-d3cd2157.js";import{C as Y}from"./confirmdialog.esm-3c4cbf5c.js";import{H as Z}from"./HeaderModule-b06ca799.js";import{D as ee}from"./dropdown.esm-0caba294.js";import{P as se}from"./progressspinner.esm-5c964cda.js";import{S as d}from"./skeleton.esm-b303042b.js";import"./Dropdown-b69220a2.js";import"./ripple.esm-4b355069.js";import"./inputnumber.esm-6c4b14f0.js";import"./index.esm-9ef49f43.js";import"./index.esm-dca36cda.js";import"./index.esm-64ce51d8.js";import"./csstransition.esm-03d4c013.js";import"./inheritsLoose-2f6bfe9f.js";import"./index.esm-80aa95ee.js";import"./portal.esm-545bb246.js";import"./index.esm-c27cbd20.js";import"./assertThisInitialized-081f9914.js";const Fe=({auth:m})=>{const[o,I]=t.useState(""),[F,G]=t.useState(""),[E,T]=t.useState(""),{roles:ae,permissions:c}=m.user,[A,p]=t.useState(!1),[L,u]=t.useState(!1),[M,l]=t.useState(!1),[z,H]=t.useState(!0),V=Array.from({length:5},(s,a)=>a),h=t.useRef(null),$=t.useRef(null),B=t.useRef(null);t.useRef(null);let f="",j=!1;const{data:y,setData:k,post:O,put:re,reset:N,processing:te,errors:le}=C({name:"",guard_name:"web"}),{data:v,setData:w,post:W,put:ne,reset:oe}=C({name:"",group_name:""});t.useState({global:{value:null,matchMode:J.CONTAINS}}),t.useState("");async function x(){l(r=>!0);let a=await(await fetch("/api/roles")).json();I(r=>a.roles),l(r=>!1)}async function P(){l(r=>!0);let a=await(await fetch("/api/permissions")).json();G(r=>a.permissions),T(r=>a.permissionGroups),l(r=>!1)}t.useEffect(()=>{(async()=>{try{await Promise.all([x(),P()]),l(!1),H(a=>a=!1)}catch(a){console.error("Error fetching data:",a)}})()},[]);const b=s=>{h.current.show({severity:"success",summary:"Success",detail:`${s} data berhasil`,life:3e3})},U=()=>{h.current.show({severity:"error",summary:"Error",detail:"Edit data gagal",life:3e3})},S=(s,a)=>{s.preventDefault(),a=="roles"?O("/"+a,{onSuccess:()=>{b("Tambah"),p(r=>!1),x(),N("name")}}):W("/"+a,{onSuccess:()=>{b("Tambah"),u(r=>!1),P(),N("name")}})};c.includes("tambah role"),c.includes("tambah permission");const q=async(s,a)=>{l(n=>!0);let r;a.permissionIds.includes(s)?r=a.permissionIds.filter(n=>n!==s):(a.permissionIds.push(s),r=a.permissionIds);try{await K.put("/role-permission-sync/"+a.id,{data:r}),x(),b("Update")}catch{U()}};return z?e.jsx(e.Fragment,{children:e.jsx(R,{auth:m.user,className:"",children:e.jsx("div",{className:"card my-5",children:e.jsxs(Q,{value:V,className:"p-datatable-striped dark:bg-slate-900",pt:{bodyRow:"dark:bg-transparent bg-transparent dark:text-gray-300",table:"dark:bg-transparent bg-white dark:text-gray-300",header:"dark:bg-transparent"},children:[e.jsx(i,{style:{width:"25%"},body:e.jsx(d,{}),headerClassName:"dark:border-none pl-6 bg-transparent dark:bg-transparent dark:text-gray-300"}),e.jsx(i,{style:{width:"25%"},body:e.jsx(d,{}),headerClassName:"dark:border-none pl-6 bg-transparent dark:bg-transparent dark:text-gray-300"}),e.jsx(i,{style:{width:"25%"},body:e.jsx(d,{}),headerClassName:"dark:border-none pl-6 bg-transparent dark:bg-transparent dark:text-gray-300"}),e.jsx(i,{style:{width:"25%"},body:e.jsx(d,{}),headerClassName:"dark:border-none pl-6 bg-transparent dark:bg-transparent dark:text-gray-300"})]})})})}):e.jsxs(R,{auth:m.user,className:"",children:[e.jsx(X,{ref:h}),e.jsx(Y,{}),e.jsx(Z,{title:"Role & Perizinan"}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(D,{ref:$,header:"Role",headerClassName:"shadow-lg dark:text-white",className:"bg-white  dark:glass dark:text-white",contentClassName:" dark:glass dark:text-white",visible:A,onHide:()=>p(!1),style:{width:"50vw"},children:e.jsxs("form",{onSubmit:s=>S(s,"roles"),children:[e.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",children:"Role"}),e.jsx(g,{className:"dark:bg-gray-300",id:"name",value:y.name,onChange:s=>k("name",s.target.value),"aria-describedby":"name-help"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"guard_name",children:"Guard"}),e.jsx(g,{id:"guard_name",value:y.guard_name,onChange:s=>k("guard_name",s.target.value),"aria-describedby":"guard_name-help"})]})]}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(_,{label:"Submit",className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(D,{ref:B,header:"Permission",headerClassName:"shadow-md dark:text-white",className:"bg-white dark:glass dark:text-white",style:{width:"50vw"},contentClassName:" dark:glass dark:text-white",breakpoints:{},visible:L,onHide:()=>u(!1),children:e.jsxs("form",{onSubmit:s=>S(s,"permissions"),children:[e.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",children:"Permission"}),e.jsx(g,{className:"dark:bg-gray-300",id:"name",value:v.name,onChange:s=>w("name",s.target.value),"aria-describedby":"name-help"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"group_name",children:"Grup"}),e.jsx(ee,{editable:!0,value:v.group_name,onChange:s=>w("group_name",s.target.value),options:E,optionLabel:"name",placeholder:"Pilih Grup",className:"w-full md:w-14rem"})]})]}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(_,{label:"Submit",className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})}),c.includes("setting role permission")&&e.jsx("div",{className:"flex h-[80%] mx-auto my-5",children:e.jsx("div",{className:"card w-full h-full overflow-y-auto dark:glass flex rounded-lg justify-content-center overflow-x-auto shadow-md",children:e.jsxs("table",{className:"w-full h-full bg-white dark:bg-transparent dark:border-none border-gray-300 text-black dark:text-gray-300",children:[e.jsxs("thead",{className:"rounded-tr-lg sticky z-20 backdrop-blur-3xl dark:bg-slate-700 bg-white top-0",children:[e.jsxs("tr",{className:"rounded-tr-lg",children:[e.jsx("th",{className:"w-[15%] py-2 px-4 border-b border-r dark:border-none",children:"Perizinan"}),e.jsx("th",{className:"py-2 px-4 border-b dark:border-none",colSpan:o.length,children:"Role"})]}),e.jsxs("tr",{className:"shadow-custome",children:[e.jsx("th",{className:"py-2 px-4 border-b border-r dark:border-none",children:"Aksi"}),o.map(s=>e.jsx("th",{className:"py-2 px-4 border-b border-r dark:border-none",children:s.name}))]})]}),e.jsx("tbody",{className:"",children:F.map((s,a)=>e.jsxs(e.Fragment,{children:[j=f===s.group_name,j?null:e.jsx("tr",{className:"text-left bg-slate-50 dark:glass border dark:border-none",children:e.jsx("td",{className:"py-2 font-bold px-4 border-r dark:border-none",colSpan:o.length+1,children:s.group_name})}),e.jsxs("tr",{className:"border dark:border-none",children:[e.jsx("td",{className:"py-2 text-left px-4 border-r dark:border-none",children:s.name}),o.map(r=>{var n;return e.jsx("td",{className:"w-[60px] text-center border-r dark:border-none",children:M?e.jsx(se,{style:{width:"5px",height:"5px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s",className:"z-4"}):e.jsx("input",{type:"checkbox",checked:(n=r.permissionIds)==null?void 0:n.includes(s.id),onChange:()=>q(s.id,r)})},`${s.id}-${r.id}`)})]}),e.jsx("div",{className:"hidden",children:f=s.group_name})]}))})]})})})]})};export{Fe as default};
