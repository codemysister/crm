import{r as s,F as ue,W as z,j as e,d as he,y as fe,R as xe,_ as A}from"./app-183ca207.js";import{D as ge,C as f}from"./column.esm-1f1d87c0.js";import{T as be}from"./toast.esm-b97f2233.js";import{B as d}from"./button.esm-d3cd2157.js";import{D as we}from"./DashboardLayout-217cf030.js";import{H as ye}from"./HeaderModule-b06ca799.js";import{C as K,c as je}from"./confirmdialog.esm-3c4cbf5c.js";import{g as ke}from"./getViewportSize-e6da2c0c.js";import{S as Se}from"./SkeletonDatatable-07c9c4e2.js";import{S as _e}from"./sidebar.esm-1f854c9b.js";import{D as H}from"./dropdown.esm-0caba294.js";import{C as O}from"./calendar.esm-fe4692a5.js";import{O as Ne}from"./overlaypanel.esm-9c3ae74e.js";import{T as ve,a as _}from"./tabview.esm-5482a716.js";import{H as Te}from"./HeaderDatatable-497e5508.js";import{f as Pe}from"./formatNPWP-cf5b7efc.js";import{f as N}from"./formatDate-5c964a42.js";import{L as Ce,A as De}from"./ArsipComponent-6d496fd7.js";import{h as Ee}from"./handleSelectedDetailInstitution-5c7c27d9.js";import{P as Le}from"./PermissionErrorDialog-eff24ba6.js";import"./ripple.esm-4b355069.js";import"./inputnumber.esm-6c4b14f0.js";import"./inputtext.esm-0c7f541c.js";import"./index.esm-9ef49f43.js";import"./index.esm-dca36cda.js";import"./index.esm-64ce51d8.js";import"./csstransition.esm-03d4c013.js";import"./inheritsLoose-2f6bfe9f.js";import"./index.esm-80aa95ee.js";import"./portal.esm-545bb246.js";import"./index.esm-c27cbd20.js";import"./assertThisInitialized-081f9914.js";import"./Dropdown-b69220a2.js";import"./dialog.esm-202fdef4.js";import"./skeleton.esm-b303042b.js";import"./index.esm-d51fec0e.js";import"./badge.esm-c550247d.js";import"./message.esm-4bbe4c64.js";function Pt({auth:p,sphsDefault:U,partnersProp:V,signaturesProp:Fe,usersProp:B}){const[v,T]=s.useState(U),[u,M]=s.useState(null);s.useState(V);const[x,Ie]=s.useState(B),i=ke().width<992,[W,c]=s.useState(!1),[X,P]=s.useState(!1),[o,$]=s.useState(0);s.useRef(null);const C=s.useRef(null),D=s.useRef(null),[q,g]=s.useState(null),Y=s.useRef(null),[G,J]=s.useState(!0),b=s.useRef(null),[Q,w]=s.useState(!1),{roles:ze,permissions:y,data:E}=p.user,[L,Z]=s.useState({global:{value:null,matchMode:ue.CONTAINS}}),{data:Ae,setData:Ke,post:He,put:Oe,delete:ee,reset:Ue,processing:Ve,errors:Be}=z({uuid:"",name:"",category:"",price:"",unit:"",description:""}),{data:l,setData:h,reset:te}=z({user:null,input_date:{start:null,end:null},institution_type:null});s.useState("");const j=async()=>{c(!0);let a=await(await fetch("/api/sph")).json();T(n=>a),c(!1)};s.useEffect(()=>{F(j)},[]),s.useEffect(()=>{o==0&&F(j)},[o]);const F=async t=>{try{await Promise.all([t()]),c(!1),J(a=>a=!1)}catch(a){console.error("Error fetching data:",a)}},ae=t=>e.jsx(xe.Fragment,{children:e.jsx("i",{className:"pi pi-ellipsis-h pointer cursor-pointer",onClick:a=>{M(t),C.current.toggle(a)}})}),k=t=>{b.current.show({severity:"success",summary:"Success",detail:`${t} data berhasil`,life:3e3})},S=t=>{b.current.show({severity:"error",summary:"Error",detail:`${t} data gagal`,life:3e3})},se=()=>{ee("sph/"+u.uuid,{onSuccess:()=>{j(),k("Hapus")},onError:()=>{S("Hapus")}})},re=(t,a)=>t?e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:t.name})}):e.jsx("span",{children:a.placeholder}),le=t=>e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:t.name})}),ne=()=>{const t=v.map(a=>({Kode:a.code??"-",Lembaga:a.partner_name??"-",NPWP:a.lead==null?a.partner.npwp:"-",Link_Dokumen:{v:window.location.origin+"/"+a.sph_doc,h:"link",l:{Target:window.location.origin+"/"+a.sph_doc,Tooltip:"Klik untuk membuka dokumen"}},Tanggal_Pembuatan:N(a.created_at),Diinput_Oleh:a.created_by.name}));A(()=>import("./xlsx-6ed613d4.js"),[]).then(a=>{const r={Sheets:{data:a.utils.json_to_sheet(t)},SheetNames:["data"]},m=a.write(r,{bookType:"xlsx",type:"array"});ie(m,"sph_"+N(new Date))})},ie=(t,a)=>{A(()=>import("./FileSaver.min-a64440ff.js").then(n=>n.F),["assets/FileSaver.min-a64440ff.js","assets/app-183ca207.js","assets/app-22bdcf69.css"]).then(n=>{if(n&&n.default){let r="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",m=".xlsx";const me=new Blob([t],{type:r});n.default.saveAs(me,a+m)}})},I=["partner.name","partner.npwp","code","status.name"],R=[{field:"code",header:"Kode",frozen:!i,style:i?null:{width:"max-content",whiteSpace:"nowrap"}},{header:"Lembaga",frozen:!i,style:{width:"max-content",whiteSpace:"nowrap"},body:t=>e.jsx("button",{onClick:()=>Ee(t),className:"hover:text-blue-700 text-left",children:t.partner_name})},{field:"npwp",header:"NPWP",frozen:!i,style:i?null:{width:"max-content",whiteSpace:"nowrap"},body:t=>{var a;return t.lead!=null?"-":((a=t.partner)==null?void 0:a.npwp)!==null?Pe(t.partner.npwp):"-"}},{field:"sph_doc",header:"Dokumen",frozen:!i,style:i?null:{width:"max-content",whiteSpace:"nowrap"},body:t=>e.jsx("div",{className:"flex w-full h-full items-center justify-center",children:e.jsx("a",{href:t.sph_doc,download:`SPH_${t.partner_name}`,class:"font-bold  w-full h-full text-center rounded-full ",children:e.jsx("i",{className:"pi pi-file-pdf",style:{width:"100%",height:"100%",fontSize:"1.5rem"}})})})}],oe=()=>e.jsxs(Te,{filters:L,setFilters:Z,children:[e.jsx(d,{className:"shadow-md w-[10px] lg:w-[90px] border border-slate-600 bg-transparent text-slate-600 dark:bg-slate-700 dark:text-slate-300 rounded-lg",onClick:()=>g(!0),children:e.jsxs("span",{className:"w-full flex justify-center items-center gap-1",children:[e.jsx("i",{className:"pi pi-filter",style:{fontSize:"0.7rem"}})," ",!i&&e.jsx("span",{children:"filter"})]})}),e.jsx(d,{className:"shadow-md w-[10px] lg:w-[90px] bg-transparent text-slate-600 dark:bg-slate-700 dark:text-slate-300 dark:border rounded-lg",onClick:ne,"data-pr-tooltip":"XLS",children:e.jsxs("span",{className:"w-full flex items-center justify-center gap-1",children:[e.jsx("i",{className:"pi pi-file-excel",style:{fontSize:"0.8rem"}})," ",!i&&e.jsx("span",{children:"export"})]})})]}),de=()=>{je({message:"Apakah Anda yakin untuk menghapus ini?",header:"Konfirmasi hapus",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>{P(!0)}})},pe=async t=>{t.preventDefault(),c(!0);const a={user:l.user,input_date:l.input_date,institution_type:l.institution_type},n=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),m=(await axios.post("/sph/filter",a,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n}})).data;T(m),g(!1),c(!1)},ce=t=>{let a;const r=t.split(".")[0];return r=="partner_name"?a="Lembaga":r=="partner_pic"?a="PIC":r=="sales_name"?a="Sales":r=="sales_wa"?a="Wa Sales":r=="sales_email"?a="Email Sales":r=="signature_name"?a="Tanda Tangan":r=="code"&&(a="Kode"),a};return G?e.jsx(Se,{auth:p}):e.jsxs(we,{auth:p.user,className:"",children:[e.jsx(be,{ref:b}),e.jsx(Le,{dialogIsVisible:Q,setDialogVisible:w}),e.jsx(ye,{title:"Surat Penawaran Harga",children:y.includes("tambah sph")&&e.jsxs(he,{href:"/sph/create",className:"bg-purple-600 block text-white py-2 px-3 font-semibold text-sm shadow-md rounded-lg mr-2",children:[e.jsx("i",{className:"pi pi-plus",style:{fontSize:"0.7rem",paddingRight:"5px"}}),"Tambah"]})}),e.jsx(_e,{header:"Filter",visible:q,className:"w-full md:w-[30%] px-3 dark:glass dark:text-white",position:"right",onHide:()=>g(!1),children:e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"name",children:"Berdasarkan penginput"}),e.jsx(H,{optionLabel:"name",dataKey:"id",value:l.user,onChange:t=>h("user",t.target.value),options:x,placeholder:"Pilih User",filter:!0,showClear:!0,valueTemplate:re,itemTemplate:le,className:"flex justify-center  dark:text-gray-400   "})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"institution_type",children:"Tipe Lembaga"}),e.jsx(H,{value:l.institution_type,onChange:t=>h("institution_type",t.target.value),showClear:!0,options:[{name:"Lead"},{name:"Partner"}],optionLabel:"name",optionValue:"name",placeholder:"Pilih tipe",className:"w-full md:w-14rem"})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"",children:"Tanggal Input"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{value:l.input_date.start?new Date(l.input_date.start):null,style:{height:"35px"},onChange:t=>{h("input_date",{...l.input_date,start:t.target.value})},placeholder:"mulai",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("span",{children:"-"}),e.jsx(O,{value:l.input_date.end?new Date(l.input_date.end):null,style:{height:"35px"},onChange:t=>{h("input_date",{...l.input_date,end:t.target.value})},placeholder:"selesai",showIcon:!0,dateFormat:"dd/mm/yy"})]})]}),e.jsxs("div",{className:"flex flex-row mt-5",children:[e.jsx(d,{ref:D,label:"Terapkan",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2"}),e.jsx(d,{type:"button",label:"Reset",onClick:t=>{te(),setTimeout(()=>{D.current.click()},500)},className:"outline-purple-600 outline-1 outline-dotted bg-transparent text-slate-700  text-sm shadow-md rounded-lg mr-2"})]})]})}),e.jsx(Ne,{className:" shadow-md p-1 dark:bg-slate-800 dark:text-gray-300",ref:C,children:e.jsxs("div",{className:"flex flex-col flex-wrap w-full",children:[e.jsx(d,{icon:"pi pi-pencil",label:"edit",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{y.includes("edit sph")&&u.created_by.id==E.id?fe.get("/sph/"+u.uuid):w(t=>!0)}}),e.jsx(d,{icon:"pi pi-trash",label:"hapus",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{y.includes("hapus sph")&&u.created_by.id==E.id?de():w(t=>!0)}})]})}),e.jsxs(ve,{activeIndex:o,onTabChange:t=>{$(t.index)},className:"mt-2",children:[e.jsx(_,{header:"Semua SPH",children:o==0&&e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx(K,{group:"declarative",visible:X,onHide:()=>P(!1),message:"Konfirmasi kembali jika anda yakin!",header:"Konfirmasi kembali",icon:"pi pi-info-circle",accept:se}),e.jsx("div",{className:"flex mx-auto flex-col justify-center mt-5 gap-5",ref:Y,children:e.jsx("div",{className:"card p-fluid w-full h-full flex justify-center rounded-lg",children:e.jsxs(ge,{loading:W,className:"w-full h-auto rounded-lg dark:glass border-none text-center shadow-md",pt:{bodyRow:"dark:bg-transparent  dark:text-gray-300",table:"dark:bg-transparent bg-white dark:text-gray-300"},paginator:!0,rowsPerPageOptions:[10,25,50,100],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} - {last} dari {totalRecords}",filters:L,rows:10,emptyMessage:"Surat penawaran harga tidak ditemukan.",paginatorClassName:"dark:bg-transparent paginator-custome dark:text-gray-300 rounded-b-lg",header:oe,globalFilterFields:I,scrollable:!0,value:v,dataKey:"id",children:[e.jsx(f,{header:"Aksi",body:ae,style:{width:"max-content",whiteSpace:"nowrap"},frozen:!0,align:"center",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"}),R.map(t=>e.jsx(f,{field:t.field,header:t.header,body:t.body,style:t.style,frozen:t.frozen,align:"left",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"})),e.jsx(f,{field:"created_at",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Tanggal Input",align:"left",body:t=>N(t.created_at),style:{width:"max-content",whiteSpace:"nowrap"}}),e.jsx(f,{field:"created_by",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Diinput Oleh",align:"left",body:t=>t.created_by.name,style:{width:"max-content",whiteSpace:"nowrap"}})]})})})]})}),e.jsx(_,{header:"Log",children:o==1&&e.jsx(Ce,{auth:p,fetchUrl:"/api/sph/logs",filterUrl:"/sph/logs/filter",deleteUrl:"/sph/logs",objectKeyToIndo:ce,users:x,showSuccess:k,showError:S})}),e.jsx(_,{header:"Arsip",children:o==2&&e.jsx(De,{auth:p,users:x,fetchUrl:"/api/sph/arsip",forceDeleteUrl:"/sph/{id}/force",restoreUrl:"/sph/{id}/restore",filterUrl:"/sph/arsip/filter",columns:R,showSuccess:k,showError:S,globalFilterFields:I})})]})]})}export{Pt as default};
