import{r as t,F as Ne,W as z,j as e,R as ve}from"./app-183ca207.js";import{D as ke,C as F}from"./column.esm-1f1d87c0.js";import{T as Ce}from"./toast.esm-b97f2233.js";import{B as o}from"./button.esm-d3cd2157.js";import{D as Se}from"./DashboardLayout-217cf030.js";import{H as Fe}from"./HeaderModule-b06ca799.js";import{D as K}from"./dialog.esm-202fdef4.js";import{I as d}from"./inputtext.esm-0c7f541c.js";import{D}from"./dropdown.esm-0caba294.js";import{C as B,c as De}from"./confirmdialog.esm-3c4cbf5c.js";import{P as T}from"./password.esm-2f40b8f0.js";import{H as Te}from"./HeaderDatatable-497e5508.js";import{g as _e}from"./getViewportSize-e6da2c0c.js";import{S as Re}from"./SkeletonDatatable-07c9c4e2.js";import{S as Ie}from"./sidebar.esm-1f854c9b.js";import{O as Pe}from"./overlaypanel.esm-9c3ae74e.js";import{C as O}from"./calendar.esm-fe4692a5.js";import{T as Ue,a as _}from"./tabview.esm-5482a716.js";import{f as Ee}from"./formatDate-5c964a42.js";import{L as Le,A as Ae}from"./ArsipComponent-6d496fd7.js";import{I as g}from"./InputError-6be719bf.js";import"./ripple.esm-4b355069.js";import"./inputnumber.esm-6c4b14f0.js";import"./index.esm-9ef49f43.js";import"./index.esm-dca36cda.js";import"./index.esm-64ce51d8.js";import"./csstransition.esm-03d4c013.js";import"./inheritsLoose-2f6bfe9f.js";import"./index.esm-80aa95ee.js";import"./portal.esm-545bb246.js";import"./index.esm-c27cbd20.js";import"./assertThisInitialized-081f9914.js";import"./Dropdown-b69220a2.js";import"./index.esm-32ebe3f0.js";import"./skeleton.esm-b303042b.js";import"./index.esm-d51fec0e.js";import"./badge.esm-c550247d.js";import"./message.esm-4bbe4c64.js";import"./PermissionErrorDialog-eff24ba6.js";function Sa({auth:m}){const[b,R]=t.useState(""),[I,W]=t.useState(null),G=_e().width<992,[$,c]=t.useState(!1),[q,P]=t.useState(!1),[h,X]=t.useState(0),j=t.useRef(null),U=t.useRef(null),E=t.useRef(null),[J,w]=t.useState(null),Q=t.useRef(null),[Y,Z]=t.useState(!0),[ee,y]=t.useState(!1),[ae,N]=t.useState(!1),[L,se]=t.useState({global:{value:null,matchMode:Ne.CONTAINS}}),[v,te]=t.useState(""),{roles:Ve,permissions:k}=m.user,{data:r,setData:l,post:re,put:le,delete:ie,reset:C,processing:A,errors:f}=z({id:"",name:"",email:"",number:"",role:"",role_id:"",password:"",password_confirmation:"",new_password:null}),{data:i,setData:S,reset:ne}=z({role:null,input_date:{start:null,end:null},institution_type:null}),[oe,de]=t.useState(""),me=a=>{const s=a.target.value;let n={...L};n.global.value=s,se(n),de(s)},x=async()=>{c(!0);let s=await(await fetch("/api/users")).json();R(n=>s.users),te(n=>s.roles),c(!1)};t.useEffect(()=>{(async()=>{try{await Promise.all([x()]),c(!1),Z(s=>s=!1)}catch(s){console.error("Error fetching data:",s)}})()},[]);const u=a=>{j.current.show({severity:"success",summary:"Success",detail:`${a} data berhasil`,life:3e3})},p=a=>{j.current.show({severity:"error",summary:"Error",detail:`${a} data gagal`,life:3e3})},ce=()=>e.jsx("i",{className:"pi pi-plus",style:{fontSize:"0.7rem",paddingRight:"5px"}}),ue=(a,s)=>a?e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:a.name})}):e.jsx("span",{children:s.placeholder}),pe=a=>e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:a.name})}),he=a=>{l(s=>({...s,id:a.id,name:a.name,email:a.email,number:a.number,role:a.role,role_id:a.role_id})),N(!0)},fe=()=>{ie("users/"+I.id,{onSuccess:()=>{x(),u("Hapus")},onError:()=>{p("Hapus")}})},M=["name","role","email","number"],V=[{field:"name",header:"Nama",style:{width:"max-content",whiteSpace:"nowrap"}},{field:"role",header:"Role",style:{width:"max-content",whiteSpace:"nowrap"}},{field:"number",header:"Nomor",style:{width:"max-content",whiteSpace:"nowrap"},body:a=>a.number??"-"},{field:"email",header:"Email",style:{width:"max-content",whiteSpace:"nowrap"}}],xe=async a=>{a.preventDefault(),c(!0);const s={role:i.role,input_date:i.input_date},n=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),ye=(await axios.post("/users/filter",s,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n}})).data;R(ye),w(!1),c(!1)},ge=()=>e.jsx(Te,{globalFilterValue:oe,onGlobalFilterChange:me,children:e.jsx(o,{className:"shadow-md w-[10px] lg:w-[90px] border border-slate-600 bg-transparent text-slate-600 dark:bg-slate-700 dark:text-slate-300 rounded-lg",onClick:()=>w(!0),children:e.jsxs("span",{className:"w-full flex justify-center items-center gap-1",children:[e.jsx("i",{className:"pi pi-filter",style:{fontSize:"0.7rem"}})," ",!G&&e.jsx("span",{children:"filter"})]})})}),be=a=>e.jsx(ve.Fragment,{children:e.jsx("i",{className:"pi pi-ellipsis-h pointer cursor-pointer",onClick:s=>{W(a),U.current.toggle(s)}})}),H=(a,s)=>{a.preventDefault(),s==="tambah"?re("/users",{onSuccess:()=>{u("Tambah"),y(n=>!1),x(),C()},onError:()=>{p("Tambah")}}):le("/users/"+r.id,{onSuccess:()=>{u("Update"),N(n=>!1),x(),C()},onError:()=>{p("Update")}})},je=()=>{De({message:"Apakah Anda yakin untuk menghapus ini?",header:"Konfirmasi hapus",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>{P(!0)}})},we=a=>{let s;return a=="name"?s="Nama":a=="email"?s="Email":a=="phone_number"?s="Nomor Telepon":a=="role"&&(s="Role"),s};return Y?e.jsx(Re,{auth:m}):e.jsxs(Se,{auth:m.user,className:"",children:[e.jsx(Ce,{ref:j}),e.jsx(Ie,{header:"Filter",visible:J,className:"w-full md:w-[30%] px-3 dark:glass dark:text-white",position:"right",onHide:()=>w(!1),children:e.jsxs("form",{onSubmit:xe,children:[e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"name",children:"Berdasarkan role"}),e.jsx(D,{optionLabel:"name",dataKey:"id",value:i.role,onChange:a=>S("role",a.target.value),options:v,placeholder:"Pilih Role",filter:!0,showClear:!0,valueTemplate:ue,itemTemplate:pe,className:"flex justify-center  dark:text-gray-400   "})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"",children:"Tanggal Input"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{value:i.input_date.start?new Date(i.input_date.start):null,style:{height:"35px"},onChange:a=>{S("input_date",{...i.input_date,start:a.target.value})},placeholder:"mulai",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("span",{children:"-"}),e.jsx(O,{value:i.input_date.end?new Date(i.input_date.end):null,style:{height:"35px"},onChange:a=>{S("input_date",{...i.input_date,end:a.target.value})},placeholder:"selesai",showIcon:!0,dateFormat:"dd/mm/yy"})]})]}),e.jsxs("div",{className:"flex flex-row mt-5",children:[e.jsx(o,{ref:E,label:"Terapkan",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2"}),e.jsx(o,{type:"button",label:"Reset",onClick:a=>{ne(),setTimeout(()=>{E.current.click()},500)},className:"outline-purple-600 outline-1 outline-dotted bg-transparent text-slate-700  text-sm shadow-md rounded-lg mr-2"})]})]})}),e.jsx(Pe,{className:" shadow-md p-1 dark:bg-slate-800 dark:text-gray-300",ref:U,children:e.jsxs("div",{className:"flex flex-col flex-wrap w-full",children:[k.includes("edit sph")&&e.jsx(o,{icon:"pi pi-pencil",label:"edit",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{he(I)}}),k.includes("hapus sph")&&e.jsx(o,{icon:"pi pi-trash",label:"hapus",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{je()}})]})}),e.jsx(Fe,{title:"User",children:k.includes("tambah user")&&e.jsx(o,{label:"Tambah",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2",icon:ce,onClick:()=>{y(a=>!0),C()},"aria-controls":"popup_menu_right","aria-haspopup":!0})}),e.jsxs(Ue,{activeIndex:h,onTabChange:a=>{X(a.index)},className:"mt-2",children:[e.jsx(_,{header:"Semua User",children:h==0&&e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(B,{group:"declarative",visible:q,onHide:()=>P(!1),message:"Konfirmasi kembali jika anda yakin!",header:"Konfirmasi kembali",icon:"pi pi-info-circle",accept:fe}),e.jsx("div",{className:"flex  mx-auto flex-col justify-center mt-5 gap-5",ref:Q,children:e.jsx("div",{className:"card p-fluid w-full h-full flex justify-center rounded-lg",children:e.jsx("div",{className:"card  p-fluid w-full h-full flex justify-center rounded-lg",children:e.jsxs(ke,{loading:$,className:"w-full h-auto rounded-lg dark:glass border-none text-center shadow-md",pt:{bodyRow:"dark:bg-transparent  dark:text-gray-300",table:"dark:bg-transparent bg-white dark:text-gray-300"},paginator:!0,rowsPerPageOptions:[10,25,50,100],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} - {last} dari {totalRecords}",filters:L,rows:10,emptyMessage:"User tidak ditemukan.",paginatorClassName:"dark:bg-transparent paginator-custome dark:text-gray-300 rounded-b-lg",header:ge,globalFilterFields:M,scrollable:!0,value:b,dataKey:"id",children:[e.jsx(F,{header:"Aksi",body:be,style:{width:"max-content",whiteSpace:"nowrap"},frozen:!0,align:"center",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"}),V.map(a=>e.jsx(F,{field:a.field,header:a.header,body:a.body,style:a.style,frozen:a.frozen,align:"left",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"})),e.jsx(F,{field:"created_at",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Tanggal Input",align:"left",body:a=>Ee(a.created_at),style:{width:"max-content",whiteSpace:"nowrap"}})]})})})})]})}),e.jsx(_,{header:"Log",children:h==1&&e.jsx(Le,{auth:m,fetchUrl:"/api/users/logs",filterUrl:"/users/logs/filter",deleteUrl:"/users/logs",objectKeyToIndo:we,users:b,showSuccess:u,showError:p})}),e.jsx(_,{header:"Arsip",children:h==2&&e.jsx(Ae,{auth:m,users:b,fetchUrl:"/api/users/arsip",forceDeleteUrl:"/users/{id}/force",restoreUrl:"/users/{id}/restore",filterUrl:"/users/arsip/filter",columns:V,showSuccess:u,showError:p,globalFilterFields:M})})]}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(K,{header:"User",headerClassName:"dark:glass shadow-md dark:text-white",className:"bg-white w-[80%] md:w-[60%] lg:w-[30%] dark:glass dark:text-white",contentClassName:" dark:glass dark:text-white",visible:ee,onHide:()=>y(!1),children:e.jsxs("form",{onSubmit:a=>H(a,"tambah"),children:[e.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",children:"Nama *"}),e.jsx(d,{value:r.name,onChange:a=>l("name",a.target.value),className:"dark:bg-gray-300",id:"name","aria-describedby":"name-help"}),e.jsx(g,{message:f.name,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"email",children:"Email *"}),e.jsx(d,{value:r.email,onChange:a=>l("email",a.target.value),className:"dark:bg-gray-300",id:"email","aria-describedby":"email-help"}),e.jsx(g,{message:f.email,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"number",children:"Whatsapp"}),e.jsx(d,{value:r.number,onChange:a=>l("number",a.target.value),keyfilter:"int",className:"dark:bg-gray-300",id:"number","aria-describedby":"number-help"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"password",children:"Password *"}),e.jsx(T,{inputClassName:"w-full dark:bg-gray-300",className:"flex justify-center items-center align-middle justify-items-center",value:r.password,onChange:a=>l("password",a.target.value),toggleMask:!0,feedback:!1}),e.jsx(g,{message:f.password,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"password_confirmation",children:"Konfirmasi Password *"}),e.jsx(T,{inputClassName:"w-full dark:bg-gray-300",feedback:!1,className:"flex justify-center  items-center align-middle justify-items-center",value:r.password_confirmation,onChange:a=>l("password_confirmation",a.target.value),toggleMask:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"role",children:"Role"}),e.jsx(D,{value:r.role,onChange:a=>l("role",a.target.value),options:v,optionLabel:"name",placeholder:"Pilih Role",className:"w-full md:w-14rem dark:bg-gray-300"}),e.jsx(g,{message:f.role,className:"mt-2"})]})]}),e.jsx("div",{className:"flex justify-center my-5",children:e.jsx(o,{label:"Submit",disabled:A,className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(K,{header:"User",headerClassName:"dark:glass shadow-md dark:text-white",className:"bg-white w-[80%] md:w-[60%] lg:w-[30%] dark:glass dark:text-white",contentClassName:"dark:glass dark:text-white",visible:ae,onHide:()=>N(!1),children:e.jsxs("form",{onSubmit:a=>H(a,"update"),children:[e.jsxs("div",{className:"flex flex-col justify-around gap-4 mt-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"name",children:"Nama"}),e.jsx(d,{value:r.name,onChange:a=>l("name",a.target.value),className:"dark:bg-gray-300",id:"name","aria-describedby":"name-help"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx(d,{value:r.email,onChange:a=>l("email",a.target.value),className:"dark:bg-gray-300",id:"email","aria-describedby":"email-help"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"number",children:"Whatsapp"}),e.jsx(d,{value:r.number,onChange:a=>l("number",a.target.value),keyfilter:"int",className:"dark:bg-gray-300",id:"number","aria-describedby":"number-help"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"role",children:"Role"}),e.jsx(D,{value:r.role,onChange:a=>l("role",a.target.value),options:v,optionValue:"name",optionLabel:"name",placeholder:"Pilih Role",className:"w-full md:w-14rem dark:bg-gray-300"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"new_password",children:"Password Baru"}),e.jsx(T,{inputClassName:"w-full dark:bg-gray-300",className:"flex justify-center items-center align-middle justify-items-center",value:r.new_password,onChange:a=>l("new_password",a.target.value),toggleMask:!0,feedback:!1})]})]}),e.jsx("div",{className:"flex justify-center mt-5",children:e.jsx(o,{label:"Submit",disabled:A,className:"bg-purple-600 text-sm shadow-md rounded-lg"})})]})})})]})}export{Sa as default};
