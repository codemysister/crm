import{r,F as me,W as A,j as e,d as ue,y as fe,R as he,_ as K}from"./app-183ca207.js";import{D as ge,C as h}from"./column.esm-1f1d87c0.js";import{T as xe}from"./toast.esm-b97f2233.js";import{B as c}from"./button.esm-d3cd2157.js";import{D as be}from"./DashboardLayout-217cf030.js";import{H as we}from"./HeaderModule-b06ca799.js";import{C as z,c as ye}from"./confirmdialog.esm-3c4cbf5c.js";import{S as ke}from"./sidebar.esm-1f854c9b.js";import{S as je}from"./SkeletonDatatable-07c9c4e2.js";import{C as _e}from"./confirmpopup.esm-04dc2a7b.js";import{D as O}from"./dropdown.esm-0caba294.js";import{C as U}from"./calendar.esm-fe4692a5.js";import{O as Se}from"./overlaypanel.esm-9c3ae74e.js";import{T as ve,a as S}from"./tabview.esm-5482a716.js";import{h as Ne}from"./handleSelectedDetailInstitution-5c7c27d9.js";import{g as Te}from"./getViewportSize-e6da2c0c.js";import{H as De}from"./HeaderDatatable-497e5508.js";import{f as Ce}from"./formatNPWP-cf5b7efc.js";import{P as Pe}from"./PermissionErrorDialog-eff24ba6.js";import{f as v}from"./formatDate-5c964a42.js";import{L as Le,A as Ee}from"./ArsipComponent-6d496fd7.js";import"./ripple.esm-4b355069.js";import"./inputnumber.esm-6c4b14f0.js";import"./inputtext.esm-0c7f541c.js";import"./index.esm-9ef49f43.js";import"./index.esm-dca36cda.js";import"./index.esm-64ce51d8.js";import"./csstransition.esm-03d4c013.js";import"./inheritsLoose-2f6bfe9f.js";import"./index.esm-80aa95ee.js";import"./portal.esm-545bb246.js";import"./index.esm-c27cbd20.js";import"./assertThisInitialized-081f9914.js";import"./Dropdown-b69220a2.js";import"./dialog.esm-202fdef4.js";import"./skeleton.esm-b303042b.js";import"./index.esm-d51fec0e.js";import"./badge.esm-c550247d.js";import"./message.esm-4bbe4c64.js";function Dt({auth:p,spdsDefault:V,usersProp:H}){const[N,T]=r.useState(V),[B,o]=r.useState(!1),[M,D]=r.useState(!0),[X,g]=r.useState(null),[u,W]=r.useState(null),[x,Fe]=r.useState(H),C=r.useRef(null),b=r.useRef(null),P=r.useRef(null),$=r.useRef(null),[q,L]=r.useState(!1),[d,Y]=r.useState(0),l=Te().width<992,[G,w]=r.useState(!1),{data:E,roles:Re,permissions:y}=p.user,[F,J]=r.useState({global:{value:null,matchMode:me.CONTAINS}}),{data:Ae,setData:Ke,post:ze,put:Oe,delete:Q,reset:Ue,processing:Ve,errors:He}=A({uuid:"",name:"",category:"",price:"",unit:"",description:""}),{data:n,setData:f,reset:Z}=A({user:null,input_date:{start:null,end:null},payment_metode:null});r.useState("");const k=async()=>{o(!0);let a=await(await fetch("/api/stpd")).json();T(i=>a),o(!1)};r.useEffect(()=>{d==0&&ee(k)},[d]);const ee=async t=>{try{await Promise.all([t()]),o(!1),D(a=>a=!1)}catch(a){console.error("Error fetching data:",a)}};r.useEffect(()=>{(async()=>{try{await Promise.all([k()]),o(!1),D(a=>a=!1)}catch(a){console.error("Error fetching data:",a)}})()},[]);const te=t=>e.jsx(he.Fragment,{children:e.jsx("i",{className:"pi pi-ellipsis-h pointer cursor-pointer",onClick:a=>{W(t),P.current.toggle(a)}})}),j=t=>{b.current.show({severity:"success",summary:"Success",detail:`${t} data berhasil`,life:3e3})},_=t=>{b.current.show({severity:"error",summary:"Error",detail:`${t} data gagal`,life:3e3})},ae=t=>{Q("stpd/"+u.uuid,{onSuccess:()=>{k(),j("Hapus")},onError:()=>{_("Hapus")}})},re=(t,a)=>t?e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:t.name})}):e.jsx("span",{children:a.placeholder}),se=t=>e.jsx("div",{className:"flex align-items-center",children:e.jsx("div",{children:t.name})}),ne=()=>e.jsxs(De,{filters:F,setFilters:J,children:[e.jsx(c,{className:"shadow-md w-[10px] lg:w-[90px] border border-slate-600 bg-transparent text-slate-600 dark:bg-slate-700 dark:text-slate-300 rounded-lg",onClick:()=>g(!0),children:e.jsxs("span",{className:"w-full flex justify-center items-center gap-1",children:[e.jsx("i",{className:"pi pi-filter",style:{fontSize:"0.7rem"}})," ",!l&&e.jsx("span",{children:"filter"})]})}),e.jsx(c,{className:"shadow-md w-[10px] lg:w-[90px] bg-transparent text-slate-600 dark:bg-slate-700 dark:text-slate-300 dark:border rounded-lg",onClick:oe,"data-pr-tooltip":"XLS",children:e.jsxs("span",{className:"w-full flex items-center justify-center gap-1",children:[e.jsx("i",{className:"pi pi-file-excel",style:{fontSize:"0.8rem"}})," ",!l&&e.jsx("span",{children:"export"})]})})]}),ie=async t=>{t.preventDefault(),o(!0);const a={user:n.user,input_date:n.input_date,status:n.status},i=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),m=(await axios.post("/stpd/filter",a,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i}})).data;T(m),g(!1),o(!1)},I=[{field:"code",header:"Kode",frozen:!l,style:l?null:{width:"max-content",whiteSpace:"nowrap"}},{header:"Lembaga",frozen:!l,style:{width:"max-content",whiteSpace:"nowrap"},body:t=>e.jsx("button",{onClick:()=>Ne(t),className:"hover:text-blue-700 text-left",children:t.institution_name})},{field:"npwp",header:"NPWP",frozen:!l,style:l?null:{width:"max-content",whiteSpace:"nowrap"},body:t=>{var a;return t.lead!=null?"-":((a=t.partner)==null?void 0:a.npwp)!==null?Ce(t.partner.npwp):"-"}},{field:"stpd_doc",header:"Dokumen",frozen:!l,style:l?null:{width:"max-content",whiteSpace:"nowrap"},body:t=>e.jsx("div",{className:"flex w-full h-full items-center justify-center",children:e.jsx("a",{href:t.stpd_doc,download:`STPD_${t.institution_name}`,class:"font-bold  w-full h-full text-center rounded-full ",children:e.jsx("i",{className:"pi pi-file-pdf",style:{width:"100%",height:"100%",fontSize:"1.5rem"}})})})},{field:"departure_date",header:"Tanggal Berangkat",style:{width:"max-content",whiteSpace:"nowrap"},body:t=>new Date(t.departure_date).toLocaleDateString("id")},{field:"return_date",header:"Tanggal Kembali",style:{width:"max-content",whiteSpace:"nowrap"},body:t=>new Date(t.return_date).toLocaleDateString("id")},{field:"accommodation",header:"Akomodasi",style:{width:"max-content",whiteSpace:"nowrap"}}],le=()=>{ye({message:"Apakah Anda yakin untuk menghapus ini?",header:"Konfirmasi hapus",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>{L(!0)}})},oe=()=>{const t=N.map(a=>({Kode:a.code??"-",Lembaga:a.institution_name??"-",NPWP:a.lead==null?a.partner.npwp:"-",Link_Dokumen:{v:window.location.origin+"/"+a.sph_doc,h:"link",l:{Target:window.location.origin+"/"+a.spd_doc,Tooltip:"Klik untuk membuka dokumen"}},Tanggal_Pembuatan:v(a.created_at),Diinput_Oleh:a.created_by.name}));K(()=>import("./xlsx-6ed613d4.js"),[]).then(a=>{const s={Sheets:{data:a.utils.json_to_sheet(t)},SheetNames:["data"]},m=a.write(s,{bookType:"xlsx",type:"array"});de(m,"sph_"+v(new Date))})},de=(t,a)=>{K(()=>import("./FileSaver.min-a64440ff.js").then(i=>i.F),["assets/FileSaver.min-a64440ff.js","assets/app-183ca207.js","assets/app-22bdcf69.css"]).then(i=>{if(i&&i.default){let s="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",m=".xlsx";const pe=new Blob([t],{type:s});i.default.saveAs(pe,a+m)}})},ce=t=>{let a;const s=t.split(".")[0];return s=="institution_name"?a="Lembaga":s=="departure_date"?a="Tanggal Keberangkatan":s=="return_date"?a="Tanggal Kembali":s=="transportation"?a="Transportasi":s=="accommodation"?a="Akomodasi":s=="code"?a="Kode":s=="signature_name"&&(a="Tanda Tangan"),a},R=["institution_name","code"];return M?e.jsx(je,{auth:p}):e.jsxs(be,{auth:p.user,className:"",children:[e.jsx(xe,{ref:b}),e.jsx(_e,{}),e.jsx(we,{title:"Surat Perjalanan Dinas",children:y.includes("tambah stpd")&&e.jsxs(ue,{href:"/stpd/create",className:"bg-purple-600 block text-white py-2 px-3 font-semibold text-sm shadow-md rounded-lg mr-2",children:[e.jsx("i",{className:"pi pi-plus",style:{fontSize:"0.7rem",paddingRight:"5px"}}),"Tambah"]})}),e.jsx(Pe,{dialogIsVisible:G,setDialogVisible:w}),e.jsx(ke,{header:"Filter",visible:X,className:"w-full md:w-[30%] px-3 dark:glass dark:text-white",position:"right",onHide:()=>g(!1),children:e.jsxs("form",{onSubmit:ie,children:[e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"name",children:"Berdasarkan penginput"}),e.jsx(O,{optionLabel:"name",dataKey:"id",value:n.user,onChange:t=>f("user",t.target.value),options:x,placeholder:"Pilih User",filter:!0,showClear:!0,valueTemplate:re,itemTemplate:se,className:"flex justify-center  dark:text-gray-400   "})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"institution_type",children:"Tipe Lembaga"}),e.jsx(O,{value:n.institution_type,onChange:t=>f("institution_type",t.target.value),showClear:!0,options:[{name:"Lead"},{name:"Partner"}],optionLabel:"name",optionValue:"name",placeholder:"Pilih tipe",className:"w-full md:w-14rem"})]}),e.jsxs("div",{className:"flex flex-col mt-3",children:[e.jsx("label",{htmlFor:"",children:"Tanggal Input"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{value:n.input_date.start?new Date(n.input_date.start):null,style:{height:"35px"},onChange:t=>{f("input_date",{...n.input_date,start:t.target.value})},placeholder:"mulai",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("span",{children:"-"}),e.jsx(U,{value:n.input_date.end?new Date(n.input_date.end):null,style:{height:"35px"},onChange:t=>{f("input_date",{...n.input_date,end:t.target.value})},placeholder:"selesai",showIcon:!0,dateFormat:"dd/mm/yy"})]})]}),e.jsxs("div",{className:"flex flex-row mt-5",children:[e.jsx(c,{ref:C,label:"Terapkan",className:"bg-purple-600 text-sm shadow-md rounded-lg mr-2"}),e.jsx(c,{type:"button",label:"Reset",onClick:t=>{Z(),setTimeout(()=>{C.current.click()},500)},className:"outline-purple-600 outline-1 outline-dotted bg-transparent text-slate-700  text-sm shadow-md rounded-lg mr-2"})]})]})}),e.jsx(Se,{className:" shadow-md p-1 dark:bg-slate-800 dark:text-gray-300",ref:P,children:e.jsxs("div",{className:"flex flex-col flex-wrap w-full",children:[e.jsx(c,{icon:"pi pi-pencil",label:"edit",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{y.includes("edit stpd")&&u.created_by.id==E.id?fe.get("/stpd/"+u.uuid):w(t=>!0)}}),e.jsx(c,{icon:"pi pi-trash",label:"hapus",className:"bg-transparent hover:bg-slate-200 w-full text-slate-500 border-b-2 border-slate-400",onClick:()=>{y.includes("hapus stpd")&&u.created_by.id==E.id?le():w(t=>!0)}})]})}),e.jsxs(ve,{activeIndex:d,onTabChange:t=>{Y(t.index)},className:"mt-2",children:[e.jsx(S,{header:"Semua Invoice",children:d==0&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(z,{group:"declarative",visible:q,onHide:()=>L(!1),message:"Konfirmasi kembali jika anda yakin!",header:"Konfirmasi kembali",icon:"pi pi-info-circle",accept:ae}),e.jsx("div",{className:"flex mx-auto flex-col justify-center mt-5 gap-5",ref:$,children:e.jsx("div",{className:"card p-fluid w-full h-full flex justify-center rounded-lg",children:e.jsxs(ge,{loading:B,className:"w-full h-auto rounded-lg dark:glass border-none text-center shadow-md",pt:{bodyRow:"dark:bg-transparent  dark:text-gray-300",table:"dark:bg-transparent bg-white dark:text-gray-300"},paginator:!0,rowsPerPageOptions:[10,25,50,100],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} - {last} dari {totalRecords}",filters:F,rows:10,emptyMessage:"Surat perjalanan dinas tidak ditemukan.",paginatorClassName:"dark:bg-transparent paginator-custome dark:text-gray-300 rounded-b-lg",header:ne,globalFilterFields:R,scrollable:!0,value:N,dataKey:"id",children:[e.jsx(h,{header:"Aksi",body:te,style:{width:"max-content",whiteSpace:"nowrap"},frozen:!0,align:"center",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"}),I.map(t=>e.jsx(h,{field:t.field,header:t.header,body:t.body,style:t.style,frozen:t.frozen,editor:t.editor,align:"left",className:"dark:border-none bg-white",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300"})),e.jsx(h,{field:"created_at",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Tanggal Input",align:"left",body:t=>v(t.created_at),style:{width:"max-content",whiteSpace:"nowrap"}}),e.jsx(h,{field:"created_by",className:"dark:border-none bg-white lg:whitespace-nowrap lg:w-max",headerClassName:"dark:border-none bg-white dark:bg-slate-900 dark:text-gray-300",header:"Diinput Oleh",align:"left",body:t=>t.created_by.name,style:{width:"max-content",whiteSpace:"nowrap"}})]})})})]})}),e.jsx(S,{header:"Log",children:d==1&&e.jsx(Le,{auth:p,fetchUrl:"/api/stpd/logs",filterUrl:"/stpd/logs/filter",deleteUrl:"/stpd/logs",objectKeyToIndo:ce,users:x,showSuccess:j,showError:_})}),e.jsx(S,{header:"Arsip",children:d==2&&e.jsx(Ee,{auth:p,users:x,fetchUrl:"/api/stpd/arsip",forceDeleteUrl:"/stpd/{id}/force",restoreUrl:"/stpd/{id}/restore",filterUrl:"/stpd/arsip/filter",columns:I,showSuccess:j,showError:_,globalFilterFields:R})})]})]})}export{Dt as default};
